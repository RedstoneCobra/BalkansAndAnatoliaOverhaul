### POP Estate effects ###
POP_estate_remove_modifiers = {
	trigger_switch = {
		on_trigger = has_province_modifier
		estate_greater_nobles_territory = {
			remove_province_modifier = estate_greater_nobles_territory
		}
		estate_lesser_nobles_territory = {
			remove_province_modifier = estate_lesser_nobles_territory
		}
		estate_burghers_territory = {
			remove_province_modifier = estate_burghers_territory
		}
		estate_tribal_territory = {
			remove_province_modifier = estate_tribal_territory
		}
		estate_freeholders_territory = {
			remove_province_modifier = estate_freeholders_territory
		}
	}
}
POP_estate_remove = {
	trigger_switch = {
		on_trigger = has_estate
		estate_greater_nobles = {
			remove_estate = estate_greater_nobles
		}
		estate_lesser_nobles = {
			remove_estate = estate_lesser_nobles
		}
		estate_city_burghers = {
			remove_estate = estate_city_burghers
		}
		estate_tribes = {
			remove_estate = estate_tribes
		}
		estate_freeholders = {
			remove_estate = estate_freeholders
		}
	}
}

POP_estate_assignment = { # optimised for startup
	POP_estate_remove_modifiers = yes
	POP_estate_remove = yes
	trigger_switch = {
		on_trigger = has_province_flag
		greater_nobles_control_province = {
			set_province_flag = estate_assigned
			add_permanent_province_modifier = {
				name = estate_greater_nobles_territory
				duration = -1
			}
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_greater_nobles
			}
		}
		lesser_nobles_control_province = {
			set_province_flag = estate_assigned
			add_permanent_province_modifier = {
				name = estate_lesser_nobles_territory
				duration = -1
			}
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_lesser_nobles
			}
		}
		burghers_control_province = {
			set_province_flag = estate_assigned
			add_permanent_province_modifier = {
				name = estate_burghers_territory
				duration = -1
			}
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_city_burghers
			}
		}
		tribals_control_province = {
			set_province_flag = estate_assigned
			add_permanent_province_modifier = {
				name = estate_tribal_territory
				duration = -1
			}
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_tribes
			}
		}
		freeholders_control_province = {
			set_province_flag = estate_assigned
			add_permanent_province_modifier = {
				name = estate_freeholders_territory
				duration = -1
			}
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_freeholders
			}
		}
	}
	if = { #For new colonies
		limit = {
			NOT = {
				has_province_flag = estate_assigned
			}
		}
		if = { #For new colonies under tribes
			limit = {
				owner = { is_tribal = yes }
				OR = {
					has_province_flag = tribals_control_province
					check_variable = { which = tribals_ratio				value = 0.001 }
				}
			}
			set_province_flag = estate_assigned
		}
		else = {
			remove_tribes = yes
			set_province_flag = lesser_nobles_control_province
			set_province_flag = estate_assigned
			add_permanent_province_modifier = {
				name = estate_lesser_nobles_territory
				duration = -1
			}
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_lesser_nobles
			}
		}
	}
}

POP_estate_reassignment = {
	if = { #For new colonies
		limit = {
			NOT = {
				has_province_flag = estate_assigned
			}
		}
		if = { #For new colonies under tribes
			limit = {
				owner = { is_tribal = yes }
				OR = {
					has_province_flag = tribals_control_province
					check_variable = { which = tribals_ratio				value = 0.001 }
				}
			}
			set_province_flag = estate_assigned
		}
		else_if = { #For new colonies under tribes
			limit = {
				OR = {
					has_province_flag = tribals_control_province
					check_variable = { which = tribals_ratio				value = 0.001 }
				}
			}
			set_province_flag = estate_assigned
			set_variable = { which = tribals_ratio	value = 19.9 }
			set_variable = { which = settlement_score_progress	value = 81 }
			tribes_majority_to_minority = yes
		}
		else = {
			remove_tribes = yes
			set_province_flag = lesser_nobles_control_province
			set_province_flag = estate_assigned
		}
	}
	trigger_switch = {
		on_trigger = has_province_flag
		greater_nobles_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				if = {
					limit = {
						NOT = { has_estate = yes }
					}
					set_estate = estate_greater_nobles
				}
				else_if = {
					limit = {
						NOT = { has_estate = estate_greater_nobles }
					}
					set_estate = estate_greater_nobles
				}
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_greater_nobles_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_greater_nobles_territory
					duration = -1
				}
			}
		}
		lesser_nobles_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				if = {
					limit = {
						NOT = { has_estate = yes }
					}
					set_estate = estate_lesser_nobles
				}
				else_if = {
					limit = {
						NOT = { has_estate = estate_lesser_nobles }
					}
					set_estate = estate_lesser_nobles
				}
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_lesser_nobles_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_lesser_nobles_territory
					duration = -1
				}
			}
		}
		burghers_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				if = {
					limit = {
						NOT = { has_estate = yes }
					}
					set_estate = estate_city_burghers
				}
				else_if = {
					limit = {
						NOT = { has_estate = estate_city_burghers }
					}
					set_estate = estate_city_burghers
				}
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_burghers_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_burghers_territory
					duration = -1
				}
			}
		}
		tribals_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				if = {
					limit = {
						NOT = { has_estate = yes }
					}
					set_estate = estate_tribes
				}
				else_if = {
					limit = {
						NOT = { has_estate = estate_tribes }
					}
					set_estate = estate_tribes
				}
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_tribal_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_tribal_territory
					duration = -1
				}
			}
		}
		freeholders_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				if = {
					limit = {
						NOT = { has_estate = yes }
					}
					set_estate = estate_freeholders
				}
				else_if = {
					limit = {
						NOT = { has_estate = estate_freeholders }
					}
					set_estate = estate_freeholders
				}
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_freeholders_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_freeholders_territory
					duration = -1
				}
			}
		}
	}
}

POP_estate_reassignment_conquest = {
	trigger_switch = {
		on_trigger = has_province_flag
		greater_nobles_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_greater_nobles
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_greater_nobles_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_greater_nobles_territory
					duration = -1
				}
			}
		}
		lesser_nobles_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_lesser_nobles
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_lesser_nobles_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_lesser_nobles_territory
					duration = -1
				}
			}
		}
		burghers_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_city_burghers
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_burghers_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_burghers_territory
					duration = -1
				}
			}
		}
		tribals_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_tribes
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_tribal_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_tribal_territory
					duration = -1
				}
			}
		}
		freeholders_control_province = {
			if = {
				limit = {
					is_state = yes
					has_dlc = "The Cossacks"
				}
				set_estate = estate_freeholders
			}
			if = {
				limit = {
					NOT = { has_province_modifier = estate_freeholders_territory }
				}
				POP_estate_remove_modifiers = yes
				add_permanent_province_modifier = {
					name = estate_freeholders_territory
					duration = -1
				}
			}
		}
	}
}

add_greater_nobles_visible = {
	if = {
		limit = {
			is_state = yes
			has_dlc = "The Cossacks"
		}
		if = {
			limit = {
				NOT = { has_estate = yes }
			}
			set_estate = estate_greater_nobles
		}
		else_if = {
			limit = {
				NOT = { has_estate = estate_greater_nobles }
			}
			set_estate = estate_greater_nobles
		}
	}
	if = {
		limit = {
			NOT = { has_province_modifier = estate_greater_nobles_territory }
		}
		POP_estate_remove_modifiers = yes
		add_permanent_province_modifier = {
			name = estate_greater_nobles_territory
			duration = -1
		}
	}
	hidden_effect = {
		set_province_flag = greater_nobles_control_province
		
		EstateProv_SetUnrestMain = { estate=greater_nobles } 
	}
}

add_lesser_nobles_visible = {
	if = {
		limit = {
			is_state = yes
			has_dlc = "The Cossacks"
		}
		if = {
			limit = {
				NOT = { has_estate = yes }
			}
			set_estate = estate_lesser_nobles
		}
		else_if = {
			limit = {
				NOT = { has_estate = estate_lesser_nobles }
			}
			set_estate = estate_lesser_nobles
		}
	}
	if = {
		limit = {
			NOT = { has_province_modifier = estate_lesser_nobles_territory }
		}
		POP_estate_remove_modifiers = yes
		add_permanent_province_modifier = {
			name = estate_lesser_nobles_territory
			duration = -1
		}
	}
	hidden_effect = {
		set_province_flag = lesser_nobles_control_province
		
		EstateProv_SetUnrestMain = { estate=lesser_nobles } 
	}
}

add_burghers_visible = {
	if = {
		limit = {
			is_state = yes
			has_dlc = "The Cossacks"
		}
		if = {
			limit = {
				NOT = { has_estate = yes }
			}
			set_estate = estate_city_burghers
		}
		else_if = {
			limit = {
				NOT = { has_estate = estate_city_burghers }
			}
			set_estate = estate_city_burghers
		}
	}
	if = {
		limit = {
			NOT = { has_province_modifier = estate_burghers_territory }
		}
		POP_estate_remove_modifiers = yes
		add_permanent_province_modifier = {
			name = estate_burghers_territory
			duration = -1
		}
	}
	hidden_effect = {
		set_province_flag = burghers_control_province
		
		EstateProv_SetUnrestMain = { estate=burghers } 
	}
}

add_tribes_visible = {
	if = {
		limit = {
			is_state = yes
			has_dlc = "The Cossacks"
		}
		if = {
			limit = {
				NOT = { has_estate = yes }
			}
			set_estate = estate_tribes
		}
		else_if = {
			limit = {
				NOT = { has_estate = estate_tribes }
			}
			set_estate = estate_tribes
		}
	}
	if = {
		limit = {
			NOT = { has_province_modifier = estate_tribal_territory }
		}
		POP_estate_remove_modifiers = yes
		add_permanent_province_modifier = {
			name = estate_tribal_territory
			duration = -1
		}
	}
	hidden_effect = {
		set_province_flag = tribals_control_province
		
		EstateProv_SetUnrestMain = { estate=tribals } 
	}
}

add_freeholders_visible = {
	if = {
		limit = {
			is_state = yes
			has_dlc = "The Cossacks"
		}
		if = {
			limit = {
				NOT = { has_estate = yes }
			}
			set_estate = estate_freeholders
		}
		else_if = {
			limit = {
				NOT = { has_estate = estate_freeholders }
			}
			set_estate = estate_freeholders
		}
	}
	if = {
		limit = {
			NOT = { has_province_modifier = estate_freeholders_territory }
		}
		POP_estate_remove_modifiers = yes
		add_permanent_province_modifier = {
			name = estate_freeholders_territory
			duration = -1
		}
	}
	hidden_effect = {
		set_province_flag = freeholders_control_province
	}
}

add_greater_nobles = {
	hidden_effect = {
		if = {
			limit = {
				is_state = yes
				has_dlc = "The Cossacks"
			}
			if = {
				limit = {
					NOT = { has_estate = yes }
				}
				set_estate = estate_greater_nobles
			}
			else_if = {
				limit = {
					NOT = { has_estate = estate_greater_nobles }
				}
				set_estate = estate_greater_nobles
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = estate_greater_nobles_territory }
			}
			POP_estate_remove_modifiers = yes
			add_permanent_province_modifier = {
				name = estate_greater_nobles_territory
				duration = -1
			}
		}
		set_province_flag = greater_nobles_control_province
	}
}

add_lesser_nobles = {
	hidden_effect = {
		if = {
			limit = {
				is_state = yes
				has_dlc = "The Cossacks"
			}
			if = {
				limit = {
					NOT = { has_estate = yes }
				}
				set_estate = estate_lesser_nobles
			}
			else_if = {
				limit = {
					NOT = { has_estate = estate_lesser_nobles }
				}
				set_estate = estate_lesser_nobles
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = estate_lesser_nobles_territory }
			}
			POP_estate_remove_modifiers = yes
			add_permanent_province_modifier = {
				name = estate_lesser_nobles_territory
				duration = -1
			}
		}
		set_province_flag = lesser_nobles_control_province
	}
}

add_burghers = {
	hidden_effect = {
		if = {
			limit = {
				is_state = yes
				has_dlc = "The Cossacks"
			}
			if = {
				limit = {
					NOT = { has_estate = yes }
				}
				set_estate = estate_city_burghers
			}
			else_if = {
				limit = {
					NOT = { has_estate = estate_city_burghers }
				}
				set_estate = estate_city_burghers
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = estate_burghers_territory }
			}
			POP_estate_remove_modifiers = yes
			add_permanent_province_modifier = {
				name = estate_burghers_territory
				duration = -1
			}
		}
		set_province_flag = burghers_control_province
	}
}

add_tribes = {
	hidden_effect = {
		if = {
			limit = {
				has_province_modifier = estate_tribal_minority
			}
			remove_province_modifier = estate_tribal_minority
		}
		if = {
			limit = {
				is_state = yes
				has_dlc = "The Cossacks"
			}
			if = {
				limit = {
					NOT = { has_estate = yes }
				}
				set_estate = estate_tribes
			}
			else_if = {
				limit = {
					NOT = { has_estate = estate_tribes }
				}
				set_estate = estate_tribes
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = estate_tribal_territory }
			}
			POP_estate_remove_modifiers = yes
			add_permanent_province_modifier = {
				name = estate_tribal_territory
				duration = -1
			}
		}
		set_province_flag = tribals_control_province
		if = {
			limit = {
				has_province_modifier = estate_tribal_minority
			}
			remove_province_modifier = estate_tribal_minority
		}
	}
}

add_freeholders = {
	hidden_effect = {
		if = {
			limit = {
				is_state = yes
				has_dlc = "The Cossacks"
			}
			if = {
				limit = {
					NOT = { has_estate = yes }
				}
				set_estate = estate_freeholders
			}
			else_if = {
				limit = {
					NOT = { has_estate = estate_freeholders }
				}
				set_estate = estate_freeholders
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = estate_freeholders_territory }
			}
			POP_estate_remove_modifiers = yes
			add_permanent_province_modifier = {
				name = estate_freeholders_territory
				duration = -1
			}
		}
		set_province_flag = freeholders_control_province
	}
}

remove_greater_nobles_was = {
	hidden_effect = {
		clr_province_flag = greater_nobles_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		set_province_flag = was_greater_nobles
	}
}

remove_lesser_nobles_was = {
	hidden_effect = {
		clr_province_flag = lesser_nobles_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		set_province_flag = was_lesser_nobles
	}
}

remove_burghers_was = {
	hidden_effect = {
		clr_province_flag = burghers_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		set_province_flag = was_burghers
	}
}

remove_freeholders_was = {
	hidden_effect = {
		clr_province_flag = freeholders_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		set_province_flag = was_freeholders
	}
}

remove_greater_nobles = {
	hidden_effect = {
		clr_province_flag = greater_nobles_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
	}
}

remove_lesser_nobles = {
	hidden_effect = {
		clr_province_flag = lesser_nobles_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
	}
}

remove_burghers = {
	hidden_effect = {
		clr_province_flag = burghers_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
	}
}

# Special handling for tribes
remove_tribes_was = {
	hidden_effect = {
		clr_province_flag = tribals_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		set_province_flag = was_tribals
		add_permanent_province_modifier = {
			name = estate_tribal_minority
			duration = -1
		}
	}
}

# Complete removal of all tribes
remove_tribes = {
	hidden_effect = {
		clr_province_flag = tribals_control_province
		clr_province_flag = tribals_present
		clr_province_flag = was_tribals
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		remove_tribes_settled = yes
		remove_tribes_settled_MAPMODE = yes
		if = {
			limit = {
				has_province_modifier = estate_tribal_minority
			}
			remove_province_modifier = estate_tribal_minority
		}
		set_variable = { which = tribals_ratio	value = 0 }
		set_variable = { which = tribal_settlement_score	value = 0 }
		set_variable = { which = settlement_score_gravity	value = 0 }
		set_variable = { which = settlement_score_progress	value = 0 }
	}
}

tribes_minority_to_majority = {
	hidden_effect = {
		clr_province_flag = tribals_present
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		if = {
			limit = {
				has_province_flag = burghers_control_province
			}
			set_province_flag = was_tribals
			if = {
				limit = {
					has_province_flag = was_lesser_nobles
				}
				clr_province_flag = was_lesser_nobles_
				set_province_flag = lesser_nobles_minority
			}
			else_if = {
				limit = {
					has_province_flag = was_greater_nobles
				}
				clr_province_flag = was_greater_nobles
				set_province_flag = greater_nobles_minority
			}
			else_if = {
				limit = {
					has_province_flag = was_freeholders
				}
				clr_province_flag = was_freeholders
				set_province_flag = freeholders_minority
			}
			else = {
				set_province_flag = lesser_nobles_minority
			}
		}
		else = {
			set_province_flag = tribals_control_province
			if = {
				limit = {
					has_province_modifier = estate_tribal_minority
				}
				remove_province_modifier = estate_tribal_minority
			}
			if = {
				limit = {
					has_province_flag = lesser_nobles_control_province
				}
				clr_province_flag = lesser_nobles_control_province
				set_province_flag = lesser_nobles_minority
			}
			else_if = {
				limit = {
					has_province_flag = greater_nobles_control_province
				}
				clr_province_flag = greater_nobles_control_province
				set_province_flag = greater_nobles_minority
			}
			else_if = {
				limit = {
					has_province_flag = freeholders_control_province
				}
				clr_province_flag = freeholders_control_province
				set_province_flag = freeholders_minority
			}
			else = {
				set_province_flag = lesser_nobles_minority
			}
		}
		if = {
			limit = {
				culture = turkish
			}
			change_culture = yorouk
		}
		if = {
			limit = {
				area = epirus_area
				culture = greek
			}
			change_culture = albanian
		}
	}
}

tribes_majority_to_minority = {
	hidden_effect = {
		clr_province_flag = tribals_control_province
		clr_province_flag = was_tribals
		set_province_flag = tribals_present
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
		
		add_permanent_province_modifier = {
			name = estate_tribal_minority
			duration = -1
		}
		
		if = {
			limit = {
				has_province_flag = burghers_control_province
			}
			if = {
				limit = {
					has_province_flag = lesser_nobles_minority
				}
				clr_province_flag = lesser_nobles_minority
				set_province_flag = was_lesser_nobles
			}
			else_if = {
				limit = {
					has_province_flag = greater_nobles_minority
				}
				clr_province_flag = greater_nobles_minority
				set_province_flag = was_greater_nobles
			}
			else_if = {
				limit = {
					has_province_flag = freeholders_minority
				}
				clr_province_flag = freeholders_minority
				set_province_flag = was_freeholders
			}
			else = {
				set_province_flag = was_lesser_nobles
			}
		}
		else = {
			if = {
				limit = {
					has_province_flag = lesser_nobles_minority
				}
				clr_province_flag = lesser_nobles_minority
				set_province_flag = lesser_nobles_control_province
			}
			else_if = {
				limit = {
					has_province_flag = greater_nobles_minority
				}
				clr_province_flag = greater_nobles_minority
				set_province_flag = greater_nobles_control_province
			}
			else_if = {
				limit = {
					has_province_flag = freeholders_minority
				}
				clr_province_flag = freeholders_minority
				set_province_flag = freeholders_control_province
			}
			else = {
				set_province_flag = lesser_nobles_control_province
			}
		}
		if = {
			limit = {
				area = epirus_area
				culture = yorouk
				NOT = { owner = { primary_culture = yorouk } }
			}
			change_culture = turkish
		}
		if = {
			limit = {
				area = epirus_area
				culture = albanian
				NOT = { owner = { primary_culture = albanian } }
			}
			change_culture = greek
		}
	}
}

remove_freeholders = {
	hidden_effect = {
		clr_province_flag = freeholders_control_province
		POP_estate_remove = yes
		POP_estate_remove_modifiers = yes
	}
}


greater_nobles_ticker_check = {
	if = {
		limit = {
			check_variable = { which = estate_greater_nobles_action_ticker value = 0.01 }
		}
		set_country_flag = checking_checking
		random_list = {
			33 = { set_variable = { which = estate_greater_nobles_action_added		value = 0.5 } }
			34 = { set_variable = { which = estate_greater_nobles_action_added		value = 1 } }
			33 = { set_variable = { which = estate_greater_nobles_action_added		value = 1.5 } }
		}
		multiply_variable = { which = estate_greater_nobles_action_added 	which = estate_greater_nobles_weight_share }
		change_variable = {   which = estate_greater_nobles_action_ticker 	which = estate_greater_nobles_action_added }
		if = { ### Checks Threshold to see if event should fire
			limit = {
				check_variable = { which = estate_greater_nobles_action_ticker	value = 4 }
			}
			#	country_event = { ### Assesses what event to use
			#		id = POP_Estates.201
			#	}
		}
	}
	if = {
		limit = {
			NOT = { check_variable = { which = estate_greater_nobles_action_ticker value = 0.01 } }
		}
		set_variable = { which = estate_greater_nobles_action_ticker 		value = 0 }
		random_list = {
			33 = { set_variable = { which = estate_greater_nobles_action_added		value = 0.5 } }
			34 = { set_variable = { which = estate_greater_nobles_action_added		value = 1 } }
			33 = { set_variable = { which = estate_greater_nobles_action_added		value = 1.5 } }
		}
		multiply_variable = { which = estate_greater_nobles_action_added 	which = estate_greater_nobles_weight_share }
		change_variable = {   which = estate_greater_nobles_action_ticker 	which = estate_greater_nobles_action_added }
	}
}

lesser_nobles_ticker_check = {
	if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_action_ticker value = 0.01 }
		}
		random_list = {
			33 = { set_variable = { which = estate_lesser_nobles_action_added		value = 0.5 } }
			34 = { set_variable = { which = estate_lesser_nobles_action_added		value = 1 } }
			33 = { set_variable = { which = estate_lesser_nobles_action_added		value = 1.5 } }
		}
		multiply_variable = { which = estate_lesser_nobles_action_added 		which = estate_lesser_nobles_weight_share }
		change_variable = {   which = estate_lesser_nobles_action_ticker 	which = estate_lesser_nobles_action_added }
		if = { ### Checks Threshold to see if event should fire
			limit = {
				check_variable = { which = estate_lesser_nobles_action_ticker	value = 4 }
			}
			#	country_event = { ### Assesses what event to use
			#		id = POP_Estates.301
			#	}
		}
	}
	if = {
		limit = {
			NOT = { check_variable = { which = estate_lesser_nobles_action_ticker value = 0.01 } }
		}
		set_variable = { which = estate_lesser_nobles_action_ticker 		value = 0 }
		random_list = {
			33 = { set_variable = { which = estate_lesser_nobles_action_added		value = 0.5 } }
			34 = { set_variable = { which = estate_lesser_nobles_action_added		value = 1 } }
			33 = { set_variable = { which = estate_lesser_nobles_action_added		value = 1.5 } }
		}
		multiply_variable = { which = estate_lesser_nobles_action_added 		which = estate_lesser_nobles_weight_share }
		change_variable = {   which = estate_lesser_nobles_action_ticker 	which = estate_lesser_nobles_action_added }
	}
}

burghers_ticker_check = {
	if = {
		limit = {
			check_variable = { which = estate_burghers_action_ticker value = 0.01 }
		}
		random_list = {
			33 = { set_variable = { which = estate_burghers_action_added		value = 0.5 } }
			34 = { set_variable = { which = estate_burghers_action_added		value = 1 } }
			33 = { set_variable = { which = estate_burghers_action_added		value = 1.5 } }
		}
		multiply_variable = { which = estate_burghers_action_added 		which = estate_burghers_weight_share }
		change_variable = {   which = estate_burghers_action_ticker 		which = estate_burghers_action_added }
		if = { ### Checks Threshold to see if event should fire
			limit = {
				check_variable = { which = estate_burghers_action_ticker	value = 4 }
			}
			#	country_event = { ### Assesses what event to use
			#		id = POP_Estates.401
			#	}
		}
	}
	if = {
		limit = {
			NOT = { check_variable = { which = estate_burghers_action_ticker value = 0.01 } }
		}
		set_variable = { which = estate_burghers_action_ticker 		value = 0 }
		random_list = {
			33 = { set_variable = { which = estate_burghers_action_added		value = 0.5 } }
			34 = { set_variable = { which = estate_burghers_action_added		value = 1 } }
			33 = { set_variable = { which = estate_burghers_action_added		value = 1.5 } }
		}
		multiply_variable = { which = estate_burghers_action_added 		which = estate_burghers_weight_share }
		change_variable = {   which = estate_burghers_action_ticker 		which = estate_burghers_action_added }
	}
}

promote_lesser_nobles_loyalty = {
	if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 5 } }
		if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 7 } }
			if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 8 } }
				if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 9 } }
					owner = {
						hidden_effect = {
							change_variable = { which = estate_greater_nobles_loyalty 	value = 10 }
							change_variable = { which = estate_lesser_nobles_loyalty 	value = 10 }
						}
						add_estate_loyalty = {
							estate = estate_greater_nobles
							loyalty = 10
						}
						add_estate_loyalty = {
							estate = estate_lesser_nobles
							loyalty = 10
						}
					}
				}
				else = {
					owner = {
						hidden_effect = {
							change_variable = { which = estate_greater_nobles_loyalty 	value = 9 }
							change_variable = { which = estate_lesser_nobles_loyalty 	value = 9 }
						}
						add_estate_loyalty = {
							estate = estate_greater_nobles
							loyalty = 9
						}
						add_estate_loyalty = {
							estate = estate_lesser_nobles
							loyalty = 9
						}
					}
				}
			}
			else = {
				owner = {
					hidden_effect = {
						change_variable = { which = estate_greater_nobles_loyalty 	value = 8 }
						change_variable = { which = estate_lesser_nobles_loyalty 	value = 8 }
					}
					add_estate_loyalty = {
						estate = estate_greater_nobles
						loyalty = 8
					}
					add_estate_loyalty = {
						estate = estate_lesser_nobles
						loyalty = 8
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 6 } }
				owner = {
					hidden_effect = {
						change_variable = { which = estate_greater_nobles_loyalty 	value = 7 }
						change_variable = { which = estate_lesser_nobles_loyalty 	value = 7 }
					}
					add_estate_loyalty = {
						estate = estate_greater_nobles
						loyalty = 7
					}
					add_estate_loyalty = {
						estate = estate_lesser_nobles
						loyalty = 7
					}
				}
			}
			else = {
				owner = {
					hidden_effect = {
						change_variable = { which = estate_greater_nobles_loyalty 	value = 6 }
						change_variable = { which = estate_lesser_nobles_loyalty 	value = 6 }
					}
					add_estate_loyalty = {
						estate = estate_greater_nobles
						loyalty = 6
					}
					add_estate_loyalty = {
						estate = estate_lesser_nobles
						loyalty = 6
					}
				}
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 2 } }
			if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 3 } }
				if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 4 } }
					owner = {
						hidden_effect = {
							change_variable = { which = estate_greater_nobles_loyalty 	value = 5 }
							change_variable = { which = estate_lesser_nobles_loyalty 	value = 5 }
						}
						add_estate_loyalty = {
							estate = estate_greater_nobles
							loyalty = 5
						}
						add_estate_loyalty = {
							estate = estate_lesser_nobles
							loyalty = 5
						}
					}
				}
				else = {
					owner = {
						hidden_effect = {
							change_variable = { which = estate_greater_nobles_loyalty 	value = 4 }
							change_variable = { which = estate_lesser_nobles_loyalty 	value = 4 }
						}
						add_estate_loyalty = {
							estate = estate_greater_nobles
							loyalty = 4
						}
						add_estate_loyalty = {
							estate = estate_lesser_nobles
							loyalty = 4
						}
					}
				}
			}
			else = {
				owner = {
					hidden_effect = {
						change_variable = { which = estate_greater_nobles_loyalty 	value = 3 }
						change_variable = { which = estate_lesser_nobles_loyalty 	value = 3 }
					}
					add_estate_loyalty = {
						estate = estate_greater_nobles
						loyalty = 3
					}
					add_estate_loyalty = {
						estate = estate_lesser_nobles
						loyalty = 3
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 1 } }
				owner = {
					hidden_effect = {
						change_variable = { which = estate_greater_nobles_loyalty 	value = 2 }
						change_variable = { which = estate_lesser_nobles_loyalty 	value = 2 }
					}
					add_estate_loyalty = {
						estate = estate_greater_nobles
						loyalty = 2
					}
					add_estate_loyalty = {
						estate = estate_lesser_nobles
						loyalty = 2
					}
				}
			}
			else_if = { limit = { check_variable = { which = lesser_nobles_upgrade_value value = 0.01 } }
				owner = {
					hidden_effect = {
						change_variable = { which = estate_greater_nobles_loyalty 	value = 1 }
						change_variable = { which = estate_lesser_nobles_loyalty 	value = 1 }
					}
					add_estate_loyalty = {
						estate = estate_greater_nobles
						loyalty = 1
					}
					add_estate_loyalty = {
						estate = estate_lesser_nobles
						loyalty = 1
					}
				}
			}
		}
	}
}

corruption_payment = {
	if = { limit = { check_variable = { which = corruption_payment value = 5 } }
		if = { limit = { check_variable = { which = corruption_payment value = 7 } }
			if = { limit = { check_variable = { which = corruption_payment value = 8 } }
				if = { limit = { check_variable = { which = corruption_payment value = 9 } }
					add_corruption = 10
				}
				else = {
					add_corruption = 9
				}
			}
			else = {
				add_corruption = 8
			}
		}
		else = {
			if = { limit = { check_variable = { which = corruption_payment value = 6 } }
				add_corruption = 7
			}
			else = {
				add_corruption = 6
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = corruption_payment value = 2 } }
			if = { limit = { check_variable = { which = corruption_payment value = 3 } }
				if = { limit = { check_variable = { which = corruption_payment value = 4 } }
					add_corruption = 5
				}
				else = {
					add_corruption = 4
				}
			}
			else = {
				add_corruption = 3
			}
		}
		else = {
			if = { limit = { check_variable = { which = corruption_payment value = 1 } }
				add_corruption = 2
			}
			else_if = { limit = { check_variable = { which = corruption_payment value = 0.01 } }
				add_corruption = 1
			}
		}
	}
}


collaboration_city_wipe_variables = {
	set_variable = { which = collaboration_potential_added				value = 0 }
	set_variable = { which = crown_ducats_invested						value = 0 }
	set_variable = { which = estate_ducats_invested						value = 0 }
	set_variable = { which = ducat_cost									value = 0 }
	set_variable = { which = collaboration_potential_added_a			value = 0 }
	set_variable = { which = collaboration_potential_added_b			value = 0 }
	set_variable = { which = collaboration_potential_added_c			value = 0 }
	set_variable = { which = collaboration_potential_added_d			value = 0 }
	set_variable = { which = crown_ducats_invested_a					value = 0 }
	set_variable = { which = crown_ducats_invested_b					value = 0 }
	set_variable = { which = crown_ducats_invested_c					value = 0 }
	set_variable = { which = crown_ducats_invested_d					value = 0 }
	set_variable = { which = estate_ducats_invested_a					value = 0 }
	set_variable = { which = estate_ducats_invested_b					value = 0 }
	set_variable = { which = estate_ducats_invested_c					value = 0 }
	set_variable = { which = estate_ducats_invested_d					value = 0 }
	set_variable = { which = admin_cost_a								value = 0 }
	set_variable = { which = admin_cost_b								value = 0 }
	set_variable = { which = admin_cost_c								value = 0 }
	set_variable = { which = admin_cost_d								value = 0 }
	set_variable = { which = diplo_cost_a								value = 0 }
	set_variable = { which = diplo_cost_b								value = 0 }
	set_variable = { which = diplo_cost_c								value = 0 }
	set_variable = { which = diplo_cost_d								value = 0 }
	set_variable = { which = mil_cost_a 								value = 0 }
	set_variable = { which = mil_cost_b 								value = 0 }
	set_variable = { which = mil_cost_c 								value = 0 }
	set_variable = { which = mil_cost_d 								value = 0 }
	set_variable = { which = crisis_potential_a							value = 0 }
	set_variable = { which = crisis_potential_b							value = 0 }
	set_variable = { which = crisis_potential_c							value = 0 }
	set_variable = { which = crisis_potential_d							value = 0 }
	set_variable = { which = outside_estate_invested_a					value = 0 }
	set_variable = { which = outside_estate_invested_b					value = 0 }
	set_variable = { which = outside_estate_invested_c					value = 0 }
	set_variable = { which = outside_estate_invested_d					value = 0 }
}

spy_catch_variable_transfer = {
	set_variable = { 	  which = estate_ducats_invested_a			value = 0 }
	set_variable = { 	  which = stolen_money 						value = 0 }
}

greater_nobles_add_random_privilege = {
	
	
}

lesser_nobles_add_random_privilege = {
	
	
}

burghers_add_random_privilege = {
	
}

mil_tech_at_war_start = {
	if = {
		limit = {
			mil_tech = 50
		}
		set_country_flag = mil_tech_50_war
	}
	else_if = {
		limit = {
			mil_tech = 40
		}
		set_country_flag = mil_tech_40_war
	}
	else_if = {
		limit = {
			mil_tech = 30
		}
		set_country_flag = mil_tech_30_war
	}
	else_if = {
		limit = {
			mil_tech = 20
		}
		set_country_flag = mil_tech_20_war
	}
	else_if = {
		limit = {
			mil_tech = 10
		}
		set_country_flag = mil_tech_10_war
	}
	else = {
		set_country_flag = mil_tech_0_war
	}
}

estate_construct_unit = {
	if = {
		limit = {
			check_variable = { which = $estate$_treasury 					value = $treasury_requirement$ }
			check_variable = { which = $estate$_years_of_cash				value = 3 }
			
			NOT = { check_variable = { which = $estate$_$unit_type$_total 	which = $estate$_$unit_type$_forcelimit } }
			check_variable = { which = $estate$_$unit_type$_forcelimit		value = 1 }
		}
		change_variable = {   which = $estate$_$unit_type$ 			value = 1 }
		change_variable = {   which = $estate$_$unit_type$_total	value = 1 }
		subtract_variable = { which = $estate$_treasury 			value = $unit_cost$ }
		set_variable = { 	  which = $estate$_years_of_cash		value = 0 }
		set_variable = { 	  which = $estate$_years_of_cash		which = $estate$_treasury }
		if = {
			limit = {
				is_variable_equal = {
					which = $estate$_treasury_annual
					value = 0
				}
			}
			
			# log = "<ERROR><D195F61B><THIS:[This.GetName]><PREV:[Prev.GetName]><ROOT:[Root.GetName]><FROM:[From.GetName]> Division by zero!"
			
		}
		else = {
			divide_variable = {
				which = $estate$_years_of_cash
				which = $estate$_treasury_annual
			}
		}
	}
}

estate_construct_troops = {
	set_variable = { which = $estate_prefix$_construct_infantry 		value = 10 }
	multiply_variable = { which = $estate_prefix$_construct_infantry 	which = $infantry_amount_var$ }
	set_variable = { which = $estate_prefix$_construct_cavalry 			value = 10 }
	multiply_variable = { which = $estate_prefix$_construct_cavalry 	which = $cavalry_amount_var$ }
	set_variable = { which = $estate_prefix$_construct_artillery 		value = 0 }
	change_variable = { which = $estate_prefix$_construct_artillery 	value = $artillery_amount$ }
		
	# Recruit the rest
	while = {
		limit = {
			OR = {
				check_variable = { which = $estate_prefix$_construct_infantry 		value = 1 }
				check_variable = { which = $estate_prefix$_construct_cavalry 		value = 1 }
				check_variable = { which = $estate_prefix$_construct_artillery 		value = 1 }
			}
		}
		if = {
			limit = {
				check_variable = { which = $estate_prefix$_construct_infantry 		value = 1 }
			}
			estate_construct_unit = {
				estate = $estate$
				unit_type = infantry
				treasury_requirement = 34
				unit_cost = 28
			}
			subtract_variable = { which = $estate_prefix$_construct_infantry 		value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = $estate_prefix$_construct_cavalry 		value = 1 }
			}
			estate_construct_unit = {
				estate = $estate$
				unit_type = cavalry
				treasury_requirement = 48
				unit_cost = 42
			}
			subtract_variable = { which = $estate_prefix$_construct_cavalry 		value = 1 }
		}
		if = {
			limit = {
				check_variable = { which = $estate_prefix$_construct_artillery 		value = 1 }
			}
			estate_construct_unit = {
				estate = $estate$
				unit_type = artillery
				treasury_requirement = 72
				unit_cost = 66
			}
			subtract_variable = { which = $estate_prefix$_construct_artillery 		value = 1 }
		}
	}
	# Cleanup
	set_variable = { which = $estate_prefix$_construct_infantry 		value = 0 }
	set_variable = { which = $estate_prefix$_construct_cavalry 			value = 0 }
	set_variable = { which = $estate_prefix$_construct_artillery 		value = 0 }
}

estate_unit_recruited = {
	while = {
		limit = {
			check_variable = { which = decided_$type$_support 	value = 1 }
		}
		subtract_variable = { which = decided_$type$_support 	value = 1 }
		change_variable = {   which = $estate_prefix$_$type$_fielded 		value = 1 }
		random_owned_province = {
			limit = {
				is_city = yes
				is_core = owner
				is_overseas = no
				has_province_flag = $estate_flag$_control_province
				NOT = { has_province_flag = was_occupied }
			}
			# update the number of infantry to be built.
			if = {
				limit = {
					check_variable = { which = troops_fielded_local 	value = 1 }
				}
				change_variable = {   which = troops_fielded_local 		value = 1 }
			}
			else = {
				set_variable = {   which = troops_fielded_local 		value = 1 }
			}
		}
	}
	every_owned_province = {
		limit = {
			check_variable = { which = troops_fielded_local value = 1 }
		}
		if = {
			limit = { owner = { ai = yes } }
			cancel_construction = yes
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 64 } }
			subtract_variable = {   which = troops_fielded_local 		value = 64 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 64
				speed = 0.025
				cost = 0
			}
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 32 } }
			subtract_variable = {   which = troops_fielded_local 		value = 32 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 32
				speed = 0.05
				cost = 0
			}
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 16 } }
			subtract_variable = {   which = troops_fielded_local 		value = 16 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 16
				speed = 0.075
				cost = 0
			}
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 8 } }
			subtract_variable = {   which = troops_fielded_local 		value = 8 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 8
				speed = 0.1
				cost = 0
			}
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 4 } }
			subtract_variable = {   which = troops_fielded_local 		value = 4 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 4
				speed = 0.15
				cost = 0
			}
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 2 } }
			subtract_variable = {   which = troops_fielded_local 		value = 2 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 2
				speed = 0.2
				cost = 0
			}
		}
		if = { limit = { check_variable = { which = troops_fielded_local value = 1 } }
			subtract_variable = {   which = troops_fielded_local 		value = 1 }
			add_unit_construction = {
				type = estate_$estate_name$_$type$_$tech$
				amount = 1
				speed = 0.25
				cost = 0
			}
		}
		set_variable = {   which = troops_fielded_local 		value = 0 }
	}
}

estate_infantry_recruited = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_country_flag
			mil_tech_0_war = { ### Level 0 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = infantry
					tech = 0
				}
			}
			mil_tech_10_war = { ### Level 10 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = infantry
					tech = 10
				}
			}
			mil_tech_20_war = { ### Level 20 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = infantry
					tech = 20
				}
			}
			mil_tech_30_war = { ### Level 30 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = infantry
					tech = 30
				}
			}
			mil_tech_40_war = { ### Level 40 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = infantry
					tech = 40
				}
			}
			mil_tech_50_war = { ### Level 50 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = infantry
					tech = 50
				}
			}
		}
	}
}

estate_cavalry_recruited = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_country_flag
			mil_tech_0_war = { ### Level 0 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = cavalry
					tech = 0
				}
			}
			mil_tech_10_war = { ### Level 10 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = cavalry
					tech = 10
				}
			}
			mil_tech_20_war = { ### Level 20 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = cavalry
					tech = 20
				}
			}
			mil_tech_30_war = { ### Level 30 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = cavalry
					tech = 30
				}
			}
			mil_tech_40_war = { ### Level 40 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = cavalry
					tech = 40
				}
			}
			mil_tech_50_war = { ### Level 50 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = cavalry
					tech = 50
				}
			}
		}
	}
}

estate_artillery_recruited = {
	hidden_effect = {
		trigger_switch = {
			on_trigger = has_country_flag
			mil_tech_10_war = { ### Level 10 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = artillery
					tech = 10
				}
			}
			mil_tech_20_war = { ### Level 20 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = artillery
					tech = 20
				}
			}
			mil_tech_30_war = { ### Level 30 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = artillery
					tech = 30
				}
			}
			mil_tech_40_war = { ### Level 40 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = artillery
					tech = 40
				}
			}
			mil_tech_50_war = { ### Level 50 Levies
				estate_unit_recruited = {
					estate_name = $estate_name$
					estate_flag = $estate_flag$
					estate_prefix = $estate_prefix$
					type = artillery
					tech = 50
				}
			}
		}
	}
}

war_logistical_support = {
	hidden_effect = {
		set_variable = { which = estate_logistical_support_display		which = estate_logistical_support }
		divide_variable = { which = estate_logistical_support_display	value = 1000 }
		multiply_variable = { which = estate_logistical_support_display	value = 1000 }
		
		if = {
			limit = { check_variable = { which = estate_logistical_support value = 1024.000 } }
			subtract_variable = { which = estate_logistical_support value = 1024.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_1024 } }
				add_country_modifier = { name = war_logistical_support_1024 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_1024 }
			remove_country_modifier = war_logistical_support_1024
		}
		if = {
			limit = { check_variable = { which = estate_logistical_support value = 512.000 } }
			subtract_variable = { which = estate_logistical_support value = 512.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_512 } }
				add_country_modifier = { name = war_logistical_support_512 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_512 }
			remove_country_modifier = war_logistical_support_512
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 256.000 } }
			subtract_variable = { which = estate_logistical_support value = 256.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_256 } }
				add_country_modifier = { name = war_logistical_support_256 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_256 }
			remove_country_modifier = war_logistical_support_256
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 128.000 } }
			subtract_variable = { which = estate_logistical_support value = 128.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_128 } }
				add_country_modifier = { name = war_logistical_support_128 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_128 }
			remove_country_modifier = war_logistical_support_128
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 64.000 } }
			subtract_variable = { which = estate_logistical_support value = 64.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_64 } }
				add_country_modifier = { name = war_logistical_support_64 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_64 }
			remove_country_modifier = war_logistical_support_64
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 32.000 } }
			subtract_variable = { which = estate_logistical_support value = 32.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_32 } }
				add_country_modifier = { name = war_logistical_support_32 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_32 }
			remove_country_modifier = war_logistical_support_32
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 16.000 } }
			subtract_variable = { which = estate_logistical_support value = 16.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_16 } }
				add_country_modifier = { name = war_logistical_support_16 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_16 }
			remove_country_modifier = war_logistical_support_16
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 8.000 } }
			subtract_variable = { which = estate_logistical_support value = 8.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_8 } }
				add_country_modifier = { name = war_logistical_support_8 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_8 }
			remove_country_modifier = war_logistical_support_8
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 4.000 } }
			subtract_variable = { which = estate_logistical_support value = 4.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_4 } }
				add_country_modifier = { name = war_logistical_support_4 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_4 }
			remove_country_modifier = war_logistical_support_4
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 2.000 } }
			subtract_variable = { which = estate_logistical_support value = 2.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_2 } }
				add_country_modifier = { name = war_logistical_support_2 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_2 }
			remove_country_modifier = war_logistical_support_2
		}
		if = { limit = { check_variable = { which = estate_logistical_support value = 1.000 } }
			subtract_variable = { which = estate_logistical_support value = 1.000 }
			if = { limit = { NOT = { has_country_modifier = war_logistical_support_1 } }
				add_country_modifier = { name = war_logistical_support_1 duration = -1 hidden = yes }
			}
		}
		else_if = {
			limit = { has_country_modifier = war_logistical_support_1 }
			remove_country_modifier = war_logistical_support_1
		}
		set_variable = { which = estate_logistical_support		which = estate_logistical_support_display }
	}
}


war_logistical_support_remove = {
	if = { limit = { has_country_modifier = war_logistical_support_1024 }
		remove_country_modifier = war_logistical_support_1024
	}
	if = { limit = { has_country_modifier = war_logistical_support_512 }
		remove_country_modifier = war_logistical_support_512
	}
	if = { limit = { has_country_modifier = war_logistical_support_256 }
		remove_country_modifier = war_logistical_support_256
	}
	if = { limit = { has_country_modifier = war_logistical_support_128 }
		remove_country_modifier = war_logistical_support_128
	}
	if = { limit = { has_country_modifier = war_logistical_support_64 }
		remove_country_modifier = war_logistical_support_64
	}
	if = { limit = { has_country_modifier = war_logistical_support_32 }
		remove_country_modifier = war_logistical_support_32
	}
	if = { limit = { has_country_modifier = war_logistical_support_16 }
		remove_country_modifier = war_logistical_support_16
	}
	if = { limit = { has_country_modifier = war_logistical_support_8 }
		remove_country_modifier = war_logistical_support_8
	}
	if = { limit = { has_country_modifier = war_logistical_support_4 }
		remove_country_modifier = war_logistical_support_4
	}
	if = { limit = { has_country_modifier = war_logistical_support_2 }
		remove_country_modifier = war_logistical_support_2
	}
	if = { limit = { has_country_modifier = war_logistical_support_1 }
		remove_country_modifier = war_logistical_support_1
	}
}

noble_war_council = {
	set_country_flag = noble_war_council
	if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.9 }
		}
		add_country_modifier = {
			name = noble_war_council_10
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.8 }
		}
		add_country_modifier = {
			name = noble_war_council_9
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.7 }
		}
		add_country_modifier = {
			name = bolster_defenses_1
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.6 }
		}
		add_country_modifier = {
			name = noble_war_council_7
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.5 }
		}
		add_country_modifier = {
			name = noble_war_council_6
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.4 }
		}
		add_country_modifier = {
			name = noble_war_council_5
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.3 }
		}
		add_country_modifier = {
			name = noble_war_council_4
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.2 }
		}
		add_country_modifier = {
			name = noble_war_council_3
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.1 }
		}
		add_country_modifier = {
			name = noble_war_council_2
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share				value = 0.01 }
		}
		add_country_modifier = {
			name = noble_war_council_1
			duration = 1825
		}
	}
}

bolster_defenses = {
	set_country_flag = bolster_the_defenses
	if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.9 }
		}
		add_country_modifier = {
			name = bolster_defenses_10
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.8 }
		}
		add_country_modifier = {
			name = bolster_defenses_9
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.7 }
		}
		add_country_modifier = {
			name = bolster_defenses_8
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.6 }
		}
		add_country_modifier = {
			name = bolster_defenses_7
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.5 }
		}
		add_country_modifier = {
			name = bolster_defenses_6
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.4 }
		}
		add_country_modifier = {
			name = bolster_defenses_5
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.3 }
		}
		add_country_modifier = {
			name = bolster_defenses_4
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.2 }
		}
		add_country_modifier = {
			name = bolster_defenses_3
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.1 }
		}
		add_country_modifier = {
			name = bolster_defenses_2
			duration = 1825
		}
	}
	else_if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share				value = 0.01 }
		}
		add_country_modifier = {
			name = bolster_defenses_1
			duration = 1825
		}
	}
}

estate_manpower = {
	if = { limit = { check_variable = { which = estate_manpower value = 65000 } }
		if = { limit = { check_variable = { which = estate_manpower value = 250000 } }
			if = { limit = { check_variable = { which = estate_manpower value = 700000 } }
				if = { limit = { check_variable = { which = estate_manpower value = 1000000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 2000000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 3000000 } }
							add_manpower = 3000
						}
						else = {
							add_manpower = 2000
						}
					}
					else = {
						if = { limit = { check_variable = { which = estate_manpower value = 1500000 } }
							add_manpower = 1500
						}
						else = {
							add_manpower = 1000
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 800000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 900000 } }
							add_manpower = 900
						}
						else = {
							add_manpower = 800
						}
					}
					else = {
						add_manpower = 700
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = estate_manpower value = 400000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 500000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 600000 } }
							add_manpower = 600
						}
						else = {
							add_manpower = 500
						}
					}
					else = {
						if = { limit = { check_variable = { which = estate_manpower value = 450000 } }
							add_manpower = 450
						}
						else = {
							add_manpower = 400
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 300000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 350000 } }
							add_manpower = 350
						}
						else = {
							add_manpower = 300
						}
					}
					else = {
						add_manpower = 250
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = estate_manpower value = 135000 } }
				if = { limit = { check_variable = { which = estate_manpower value = 180000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 210000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 225000 } }
							add_manpower = 225
						}
						else = {
							add_manpower = 210
						}
					}
					else = {
						if = { limit = { check_variable = { which = estate_manpower value = 195000 } }
							add_manpower = 195
						}
						else = {
							add_manpower = 180
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 150000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 165000 } }
							add_manpower = 165
						}
						else = {
							add_manpower = 150
						}
					}
					else = {
						add_manpower = 135
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = estate_manpower value = 90000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 105000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 120000 } }
							add_manpower = 120
						}
						else = {
							add_manpower = 105
						}
					}
					else = {
						add_manpower = 90
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 70000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 75000 } }
							add_manpower = 75
						}
						else = {
							add_manpower = 70
						}
					}
					else = {
						add_manpower = 65
					}
				}
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = estate_manpower value = 15000 } }
			if = { limit = { check_variable = { which = estate_manpower value = 30000 } }
				if = { limit = { check_variable = { which = estate_manpower value = 45000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 55000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 60000 } }
							add_manpower = 60
						}
						else = {
							add_manpower = 55
						}
					}
					else = {
						if = { limit = { check_variable = { which = estate_manpower value = 50000 } }
							add_manpower = 50
						}
						else = {
							add_manpower = 45
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 35000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 40000 } }
							add_manpower = 40
						}
						else = {
							add_manpower = 35
						}
					}
					else = {
						add_manpower = 30
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = estate_manpower value = 21000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 23000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 25000 } }
							add_manpower = 25
						}
						else = {
							add_manpower = 23
						}
					}
					else = {
						add_manpower = 21
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 17000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 19000 } }
							add_manpower = 19
						}
						else = {
							add_manpower = 17
						}
					}
					else = {
						add_manpower = 15
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = estate_manpower value = 4000 } }
				if = { limit = { check_variable = { which = estate_manpower value = 7000 } }
					if = { limit = { check_variable = { which = estate_manpower value = 11000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 13000 } }
							add_manpower = 13
						}
						else = {
							add_manpower = 11
						}
					}
					else = {
						if = { limit = { check_variable = { which = estate_manpower value = 9000 } }
							add_manpower = 9
						}
						else = {
							add_manpower = 7
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 4500 } }
						if = { limit = { check_variable = { which = estate_manpower value = 5000 } }
							add_manpower = 5
						}
						else = {
							add_manpower = 4.5
						}
					}
					else = {
						add_manpower = 4
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = estate_manpower value = 2500 } }
					if = { limit = { check_variable = { which = estate_manpower value = 3000 } }
						if = { limit = { check_variable = { which = estate_manpower value = 3500 } }
							add_manpower = 3.5
						}
						else = {
							add_manpower = 3
						}
					}
					else = {
						add_manpower = 2.5
					}
				}
				else = {
					if = { limit = { check_variable = { which = estate_manpower value = 1500 } }
						if = { limit = { check_variable = { which = estate_manpower value = 2000 } }
							add_manpower = 2
						}
						else = {
							add_manpower = 1.5
						}
					}
					else_if = { limit = { check_variable = { which = estate_manpower value = 1000 } }
						add_manpower = 1
					}
				}
			}
		}
	}
}

BUR_war_relief = {
	set_country_flag = BUR_war_relief
	if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.9 }
		}
		add_country_modifier = {
			name = BUR_war_relief_10
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.8 }
		}
		add_country_modifier = {
			name = BUR_war_relief_9
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.7 }
		}
		add_country_modifier = {
			name = BUR_war_relief_8
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.6 }
		}
		add_country_modifier = {
			name = BUR_war_relief_7
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.5 }
		}
		add_country_modifier = {
			name = BUR_war_relief_6
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.4 }
		}
		add_country_modifier = {
			name = BUR_war_relief_5
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.3 }
		}
		add_country_modifier = {
			name = BUR_war_relief_4
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.2 }
		}
		add_country_modifier = {
			name = BUR_war_relief_3
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.1 }
		}
		add_country_modifier = {
			name = BUR_war_relief_2
			duration = -1
		}
	}
	else_if = {
		limit = {
			check_variable = { which = BUR_war_exhaustion_reduction				value = 0.05 }
		}
		add_country_modifier = {
			name = BUR_war_relief_1
			duration = -1
		}
	}
}

clear_estate_war_variables = {
	if = {
		limit = {
			has_country_flag = bolster_the_defenses
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			bolster_defenses_1 = {
				remove_country_modifier = bolster_defenses_1
			}
			bolster_defenses_2 = {
				remove_country_modifier = bolster_defenses_2
			}
			bolster_defenses_3 = {
				remove_country_modifier = bolster_defenses_3
			}
			bolster_defenses_4 = {
				remove_country_modifier = bolster_defenses_4
			}
			bolster_defenses_5 = {
				remove_country_modifier = bolster_defenses_5
			}
			bolster_defenses_6 = {
				remove_country_modifier = bolster_defenses_6
			}
			bolster_defenses_7 = {
				remove_country_modifier = bolster_defenses_7
			}
			bolster_defenses_8 = {
				remove_country_modifier = bolster_defenses_8
			}
			bolster_defenses_9 = {
				remove_country_modifier = bolster_defenses_9
			}
			bolster_defenses_10 = {
				remove_country_modifier = bolster_defenses_10
			}
		}
		clr_country_flag = bolster_the_defenses
	}
	if = {
		limit = {
			has_country_flag = noble_war_council
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			noble_war_council_1 = {
				remove_country_modifier = noble_war_council_1
			}
			noble_war_council_2 = {
				remove_country_modifier = noble_war_council_2
			}
			noble_war_council_3 = {
				remove_country_modifier = noble_war_council_3
			}
			noble_war_council_4 = {
				remove_country_modifier = noble_war_council_4
			}
			noble_war_council_5 = {
				remove_country_modifier = noble_war_council_5
			}
			noble_war_council_6 = {
				remove_country_modifier = noble_war_council_6
			}
			noble_war_council_7 = {
				remove_country_modifier = noble_war_council_7
			}
			bolster_defenses_1 = {
				remove_country_modifier = bolster_defenses_1
			}
			noble_war_council_9 = {
				remove_country_modifier = noble_war_council_9
			}
			noble_war_council_10 = {
				remove_country_modifier = noble_war_council_10
			}
		}
		clr_country_flag = noble_war_council
	}
	if = {
		limit = {
			has_country_flag = BUR_war_relief
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BUR_war_relief_1 = {
				remove_country_modifier = BUR_war_relief_1
			}
			BUR_war_relief_2 = {
				remove_country_modifier = BUR_war_relief_2
			}
			BUR_war_relief_3 = {
				remove_country_modifier = BUR_war_relief_3
			}
			BUR_war_relief_4 = {
				remove_country_modifier = BUR_war_relief_4
			}
			BUR_war_relief_5 = {
				remove_country_modifier = BUR_war_relief_5
			}
			BUR_war_relief_6 = {
				remove_country_modifier = BUR_war_relief_6
			}
			BUR_war_relief_7 = {
				remove_country_modifier = BUR_war_relief_7
			}
			BUR_war_relief_8 = {
				remove_country_modifier = BUR_war_relief_8
			}
			BUR_war_relief_9 = {
				remove_country_modifier = BUR_war_relief_9
			}
			BUR_war_relief_10 = {
				remove_country_modifier = BUR_war_relief_10
			}
		}
		clr_country_flag = BUR_war_relief
	}
	if = {
		limit = {
			OR = {
				has_country_flag = TR_partial_support
				has_country_flag = TR_full_support
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			TR_tribe_loot_5 = {
				remove_country_modifier = TR_tribe_loot_5
			}
			TR_tribe_loot_10 = {
				remove_country_modifier = TR_tribe_loot_10
			}
			TR_tribe_loot_15 = {
				remove_country_modifier = TR_tribe_loot_15
			}
			TR_tribe_loot_20 = {
				remove_country_modifier = TR_tribe_loot_20
			}
			TR_tribe_loot_25 = {
				remove_country_modifier = TR_tribe_loot_25
			}
			TR_tribe_loot_30 = {
				remove_country_modifier = TR_tribe_loot_30
			}
			TR_tribe_loot_35 = {
				remove_country_modifier = TR_tribe_loot_35
			}
			TR_tribe_loot_40 = {
				remove_country_modifier = TR_tribe_loot_40
			}
			TR_tribe_loot_45 = {
				remove_country_modifier = TR_tribe_loot_45
			}
			TR_tribe_loot_50 = {
				remove_country_modifier = TR_tribe_loot_50
			}
		}
	}
	clr_country_flag = GN_2_free_pick_used
	clr_country_flag = GN_2_free_pick
	clr_country_flag = GN_1_free_pick_used
	clr_country_flag = GN_1_free_pick
	clr_country_flag = GN_partial_support
	clr_country_flag = GN_full_support
	clr_country_flag = GN_offensive_war_help_partial
	clr_country_flag = GN_offensive_war_help_full
	clr_country_flag = TR_2_free_pick_used
	clr_country_flag = TR_2_free_pick
	clr_country_flag = TR_1_free_pick_used
	clr_country_flag = TR_1_free_pick
	clr_country_flag = TR_offensive_war_help_partial
	clr_country_flag = TR_offensive_war_help_full
	clr_country_flag = mil_tech_0_war
	clr_country_flag = mil_tech_10_war
	clr_country_flag = mil_tech_20_war
	clr_country_flag = mil_tech_30_war
	clr_country_flag = mil_tech_40_war
	clr_country_flag = mil_tech_50_war
	clr_country_flag = LN_2_free_pick_used
	clr_country_flag = LN_2_free_pick
	clr_country_flag = LN_1_free_pick_used
	clr_country_flag = LN_1_free_pick
	clr_country_flag = LN_partial_support
	clr_country_flag = LN_full_support
	clr_country_flag = LN_offensive_war_help_partial
	clr_country_flag = LN_offensive_war_help_full
	clr_country_flag = bolster_the_defenses
	clr_country_flag = BUR_war_financial_contribution
	clr_country_flag = BUR_logistical_support
	clr_country_flag = BUR_free_pick_assigned
	
	set_variable = { which = GN_free_picks 											value = 0 }
	set_variable = { which = LN_free_picks 											value = 0 }
	set_variable = { which = TR_free_picks 											value = 0 }
	set_variable = { which = partial_infantry_support								value = 0 }
	set_variable = { which = partial_cavalry_support								value = 0 }
	set_variable = { which = partial_artillery_support								value = 0 }
	set_variable = { which = estate_greater_nobles_loyalty_scaled_removed_a			value = 0 }
	set_variable = { which = full_infantry_support									value = 0 }
	set_variable = { which = full_cavalry_support									value = 0 }
	set_variable = { which = full_artillery_support									value = 0 }
	set_variable = { which = estate_logistical_support_partial						value = 0 }
	set_variable = { which = estate_logistical_support_full							value = 0 }
	set_variable = { which = decided_infantry_support								value = 0 }
	set_variable = { which = decided_cavalry_support								value = 0 }
	set_variable = { which = decided_artillery_support								value = 0 }
	set_variable = { which = GN_infantry_fielded									value = 0 }
	set_variable = { which = GN_cavalry_fielded										value = 0 }
	set_variable = { which = GN_artillery_fielded									value = 0 }
	set_variable = { which = LN_infantry_fielded									value = 0 }
	set_variable = { which = LN_cavalry_fielded										value = 0 }
	set_variable = { which = LN_artillery_fielded									value = 0 }
	set_variable = { which = TR_infantry_fielded									value = 0 }
	set_variable = { which = TR_cavalry_fielded										value = 0 }
	set_variable = { which = estate_logistical_support								value = 0 }
	set_variable = { which = estate_logistical_support_partial						value = 0 }
	set_variable = { which = estate_logistical_support_full							value = 0 }
	set_variable = { which = estate_lesser_nobles_loyalty_scaled_removed_a			value = 0 }
	set_variable = { which = estate_burghers_war_contribution						value = 0 }
	set_variable = { which = estate_burghers_logistical_support						value = 0 }
	set_variable = { which = BUR_war_exhaustion_reduction							value = 0 }
	set_variable = { which = BUR_free_picks											value = 0 }
	
	every_owned_province = {
		set_variable = { which = recruit_infantry				value = 0 }
		set_variable = { which = recruit_cavalry				value = 0 }
		set_variable = { which = recruit_artillery				value = 0 }
	}
	
	set_variable = { which = GN_total_survived					value = 0 }
	set_variable = { which = GN_total_started					value = 0 }
	set_variable = { which = GN_total_casualties 				value = 0 }
	
	set_variable = { which = LN_total_survived					value = 0 }
	set_variable = { which = LN_total_started					value = 0 }
	set_variable = { which = LN_total_casualties 				value = 0 }
	
	set_variable = { which = GN_infantry_remaining				value = 0 }
	set_variable = { which = GN_cavalry_remaining 				value = 0 }
	set_variable = { which = GN_artillery_remaining 			value = 0 }
	set_variable = { which = LN_infantry_remaining				value = 0 }
	set_variable = { which = LN_cavalry_remaining 				value = 0 }
	set_variable = { which = LN_artillery_remaining 			value = 0 }
	set_variable = { which = TR_infantry_remaining				value = 0 }
	set_variable = { which = TR_cavalry_remaining 				value = 0 }
	
	
	set_variable = { which = TR_loyal_infantry_remaining		value = 0 }
	set_variable = { which = TR_loyal_cavalry_remaining			value = 0 }
	set_variable = { which = TR_loyal_started					value = 0 }
	set_variable = { which = TR_loyal_survived					value = 0 }
	set_variable = { which = TR_loyal_casualties_gross			value = 0 }
	set_variable = { which = TR_casualties_reduced_wealth		value = 0 }
	set_variable = { which = TR_casualties_reduced_loyalty		value = 0 }
	
	remove_country_modifier = estate_war_support
	
	#ptm_subtribe_postwar_cleanup = yes
}

clear_POP_Estates_501_variables = {
	set_variable = { which = crisis_potential_a 	value = 0 }
	set_variable = { which = crisis_potential_b 	value = 0 }
	set_variable = { which = crisis_potential_c 	value = 0 }
	owner = {
		set_variable = { which = crisis_potential_a 					value = 0 }
		set_variable = { which = crisis_potential_b 					value = 0 }
		set_variable = { which = crisis_potential_c 					value = 0 }
		set_variable = { which = estate_burghers_province_percentage		value = 0 }
		set_variable = { which = diplo_cost_b 							value = 0 }
		set_variable = { which = mil_cost_c								value = 0 }
		set_variable = { which = nobles_burghers_disparity 				value = 0 }
		set_variable = { which = burghers_nobles_disparity 				value = 0 }
	}
}

clear_corruption_modifier = {
	trigger_switch = {
		on_trigger = has_country_modifier
		$estate_prefix$_privileges_corruption_1 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_1
		}
		$estate_prefix$_privileges_corruption_2 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_2
		}
		$estate_prefix$_privileges_corruption_3 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_3
		}
		$estate_prefix$_privileges_corruption_4 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_4
		}
		$estate_prefix$_privileges_corruption_5 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_5
		}
		$estate_prefix$_privileges_corruption_6 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_6
		}
		$estate_prefix$_privileges_corruption_7 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_7
		}
		$estate_prefix$_privileges_corruption_8 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_8
		}
		$estate_prefix$_privileges_corruption_9 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_9
		}
		$estate_prefix$_privileges_corruption_10 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_10
		}
		$estate_prefix$_privileges_corruption_12 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_12
		}
		$estate_prefix$_privileges_corruption_14 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_14
		}
		$estate_prefix$_privileges_corruption_16 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_16
		}
		$estate_prefix$_privileges_corruption_18 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_18
		}
		$estate_prefix$_privileges_corruption_20 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_20
		}
		$estate_prefix$_privileges_corruption_23 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_23
		}
		$estate_prefix$_privileges_corruption_26 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_26
		}
		$estate_prefix$_privileges_corruption_29 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_29
		}
		$estate_prefix$_privileges_corruption_32 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_32
		}
		$estate_prefix$_privileges_corruption_35 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_35
		}
		$estate_prefix$_privileges_corruption_38 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_38
		}
		$estate_prefix$_privileges_corruption_41 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_41
		}
		$estate_prefix$_privileges_corruption_44 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_44
		}
		$estate_prefix$_privileges_corruption_47 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_47
		}
		$estate_prefix$_privileges_corruption_50 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_50
		}
		$estate_prefix$_privileges_corruption_55 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_55
		}
		$estate_prefix$_privileges_corruption_60 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_60
		}
		$estate_prefix$_privileges_corruption_65 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_65
		}
		$estate_prefix$_privileges_corruption_70 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_70
		}
		$estate_prefix$_privileges_corruption_75 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_75
		}
		$estate_prefix$_privileges_corruption_80 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_80
		}
		$estate_prefix$_privileges_corruption_85 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_85
		}
		$estate_prefix$_privileges_corruption_90 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_90
		}
		$estate_prefix$_privileges_corruption_95 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_95
		}
		$estate_prefix$_privileges_corruption_100 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_100
		}
		$estate_prefix$_privileges_corruption_110 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_110
		}
		$estate_prefix$_privileges_corruption_120 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_120
		}
		$estate_prefix$_privileges_corruption_130 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_130
		}
		$estate_prefix$_privileges_corruption_140 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_140
		}
		$estate_prefix$_privileges_corruption_150 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_150
		}
		$estate_prefix$_privileges_corruption_175 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_175
		}
		$estate_prefix$_privileges_corruption_200 = {
			remove_country_modifier = $estate_prefix$_privileges_corruption_200
		}
	}
}

assign_corruption_modifier = {
	if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 41 } }
		if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 85 } }
			if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 120 } }
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 150 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 175 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 200 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_200 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_200 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_175 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_175 duration = -1 hidden = yes }
						}
						}
					}
					else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_150 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_150 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 130 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 140 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_140 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_140 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_130 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_130 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_120 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_120 duration = -1 hidden = yes }
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 95 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 100 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 110 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_110 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_110 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_100 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_100 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_95 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_95 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 90 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_90 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_90 duration = -1 hidden = yes }
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_85 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_85 duration = -1 hidden = yes }
						}
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 60 } }
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 70 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 75 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 80 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_80 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_80 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_75 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_75 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_70 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_70 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 65 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_65 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_65 duration = -1 hidden = yes }
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_60 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_60 duration = -1 hidden = yes }
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 47 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 50 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 55 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_55 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_55 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_50 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_50 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_47 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_47 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 44 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_44 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_44 duration = -1 hidden = yes }
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_41 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_41 duration = -1 hidden = yes }
						}
					}
				}
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 12 } }
			if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 23 } }
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 32 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 35 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 38 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_38 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_38 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_35 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_35 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_32 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_32 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 26 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 29 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_29 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_29 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_26 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_26 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_23 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_23 duration = -1 hidden = yes }
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 16 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 18 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 20 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_20 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_20 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_18 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_18 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_16 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_16 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 14 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_14 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_14 duration = -1 hidden = yes }
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_12 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_12 duration = -1 hidden = yes }
						}
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 6 } }
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 8 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 9 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 10 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_10 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_10 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_9 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_9 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_8 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_8 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 7 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_7 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_7 duration = -1 hidden = yes }
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_6 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_6 duration = -1 hidden = yes }
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 3 } }
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 4 } }
						if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 5 } }
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_5 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_5 duration = -1 hidden = yes }
							}
						}
						else = {
							if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_4 } }
								clear_corruption_modifier = {
									estate_prefix = $estate_prefix$
								}
								add_country_modifier = { name = $estate_prefix$_privileges_corruption_4 duration = -1 hidden = yes }
							}
						}
					}
					else = {
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_3 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_3 duration = -1 hidden = yes }
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 2 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_2 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_2 duration = -1 hidden = yes }
						}
					}
					else_if = { limit = { check_variable = { which = privilege_corruption_$estate_prefix$ value = 0.01 } }
						if = { limit = { NOT = { has_country_modifier = $estate_prefix$_privileges_corruption_1 } }
							clear_corruption_modifier = {
								estate_prefix = $estate_prefix$
							}
							add_country_modifier = { name = $estate_prefix$_privileges_corruption_1 duration = -1 hidden = yes }
						}
					}
					else = {
						clear_corruption_modifier = {
							estate_prefix = $estate_prefix$
						}
					}
				}
			}
		}
	}
}
POP_privilege_corruption_calc = {
	set_variable = { which = privilege_corruption_GN value = 0 }
	set_variable = { which = privilege_corruption_LN value = 0 }
	set_variable = { which = privilege_corruption_BG value = 0 }
	set_variable = { which = privilege_corruption_BU value = 0 }
	
	# Greater nobles
	if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share	value = 0.01 }
		}
		trigger_switch = {
			on_trigger = has_country_flag
			commoners_banned_from_officers_corps_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			commoners_banned_from_officers_corps_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			ceremonial_generalships_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			ceremonial_generalships_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			GN_relaxed_levy_obligations_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			GN_relaxed_levy_obligations_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			GN_tax_exemptions_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			GN_tax_exemptions_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
			GN_tax_exemptions_3 = {
				change_variable = { which = privilege_corruption_GN value = 15 }
			}
			GN_tax_exemptions_4 = {
				change_variable = { which = privilege_corruption_GN value = 20 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			GN_exclude_commoners_cabinet_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			GN_exclude_commoners_cabinet_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			GN_high_court_titles_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			GN_high_court_titles_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			GN_high_nobles_court_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			GN_high_nobles_court_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			GN_authority_to_govern_locally_1 = {
				change_variable = { which = privilege_corruption_GN value = 5 }
			}
			GN_authority_to_govern_locally_2 = {
				change_variable = { which = privilege_corruption_GN value = 10 }
			}
		}
		set_variable = {		which = privilege_GN_base			value = 0 }
		set_variable = { 		which = privilege_GN_base			which = privilege_corruption_GN }
		multiply_variable = {	which = privilege_corruption_GN		value = 4 } # Because otherwise this change will just reduce corruption overall unless influence is 100%
		multiply_variable = {	which = privilege_corruption_GN		which = "estate_greater_nobles_weight_share" }
	}
	# Lesser nobles
	if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share value = 0.01 }
		}
		trigger_switch = {
			on_trigger = has_country_flag
			LN_relaxed_levy_obligations_1 = {
				change_variable = { which = privilege_corruption_LN value = 5 }
			}
			LN_relaxed_levy_obligations_2 = {
				change_variable = { which = privilege_corruption_LN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			LN_tax_exemptions_1 = {
				change_variable = { which = privilege_corruption_LN value = 5 }
			}
			LN_tax_exemptions_2 = {
				change_variable = { which = privilege_corruption_LN value = 10 }
			}
			LN_tax_exemptions_3 = {
				change_variable = { which = privilege_corruption_LN value = 15 }
			}
			LN_tax_exemptions_4 = {
				change_variable = { which = privilege_corruption_LN value = 20 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			LN_high_court_titles_1 = {
				change_variable = { which = privilege_corruption_LN value = 5 }
			}
			LN_high_court_titles_2 = {
				change_variable = { which = privilege_corruption_LN value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			LN_authority_to_govern_locally_1 = {
				change_variable = { which = privilege_corruption_LN value = 5 }
			}
			LN_authority_to_govern_locally_2 = {
				change_variable = { which = privilege_corruption_LN value = 10 }
			}
		}
		set_variable = {		which = privilege_LN_base			value = 0 }
		set_variable = {		which = privilege_LN_base			which = privilege_corruption_LN }
		multiply_variable = {	which = privilege_corruption_LN		value = 4 } # Because otherwise this change will just reduce corruption overall unless influence is 100%
		multiply_variable = {	which = privilege_corruption_LN		which = "estate_lesser_nobles_weight_share" }
	}
	# Burghers
	if = {
		limit = {
			check_variable = { which = estate_burghers_weight_share value = 0.01 }
		}
		trigger_switch = {
			on_trigger = has_country_flag
			BG_tolerate_smuggling_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_tolerate_smuggling_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_honorary_noble_titles_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_honorary_noble_titles_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_right_of_commerce_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_right_of_commerce_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_authority_to_govern_locally_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_authority_to_govern_locally_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_resist_embargoes_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_resist_embargoes_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_exemption_from_military_services_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_exemption_from_military_services_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_expanded_ship_builders_privileges_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_expanded_ship_builders_privileges_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_appoint_as_court_suppliers_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_appoint_as_court_suppliers_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		trigger_switch = {
			on_trigger = has_country_flag
			BG_monopoly_on_armaments_1 = {
				change_variable = { which = privilege_corruption_BG value = 5 }
			}
			BG_monopoly_on_armaments_2 = {
				change_variable = { which = privilege_corruption_BG value = 10 }
			}
		}
		
		set_variable = {		which = privilege_BG_base			value = 0 }
		set_variable = {		which = privilege_BG_base			which = privilege_corruption_BG }
		multiply_variable = {	which = privilege_corruption_BG		value = 4 } # Because otherwise this change will just reduce corruption overall unless influence is 100%
		multiply_variable = {	which = privilege_corruption_BG		which = "estate_burghers_weight_share" }
	}
	# State
	if = {
		limit = {
			check_variable = { which = estate_bureaucracy_weight_share value = 0.01 }
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_bribery_common_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_bribery_common_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
			BU_bribery_common_3 = {
				change_variable = { which = privilege_corruption_BU value = 15 }
			}
			BU_bribery_common_4 = {
				change_variable = { which = privilege_corruption_BU value = 20 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_hereditary_admin_position_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_hereditary_admin_position_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		if = { limit = { has_country_modifier = BU_vulnerable_to_foreign_spies_1 }
			change_variable = { which = privilege_corruption_BU value = 5 }
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_culture_of_decadence_and_lazyness_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_culture_of_decadence_and_lazyness_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
			BU_culture_of_decadence_and_lazyness_3 = {
				change_variable = { which = privilege_corruption_BU value = 15 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_factionalism_common_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_factionalism_common_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_corrupted_judiciary_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_corrupted_judiciary_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_corrupted_army_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_corrupted_army_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_corrupted_navy_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_corrupted_navy_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_rampant_nepotism_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_rampant_nepotism_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
			BU_rampant_nepotism_3 = {
				change_variable = { which = privilege_corruption_BU value = 15 }
			}
			BU_rampant_nepotism_4 = {
				change_variable = { which = privilege_corruption_BU value = 20 }
			}
		}
		if = { limit = { has_country_modifier = BU_trivialized_service_honors_1 }
			change_variable = { which = privilege_corruption_BU value = 5 }
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_bloated_bureaucratic_salaries_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_bloated_bureaucratic_salaries_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		trigger_switch = {
			on_trigger = has_country_modifier
			BU_evasion_of_military_service_1 = {
				change_variable = { which = privilege_corruption_BU value = 5 }
			}
			BU_evasion_of_military_service_2 = {
				change_variable = { which = privilege_corruption_BU value = 10 }
			}
		}
		
		set_variable = {		which = privilege_BU_base				value = 0 }
		set_variable = {		which = privilege_BU_base				which = privilege_corruption_BU }
		multiply_variable = {	which = privilege_corruption_BU 		value = 2 } # Because otherwise this change will just reduce corruption overall unless influence is 100%
		
		set_variable = {		which = privilege_corruption_aggragate	value = 0 }
		change_variable = {		which = privilege_corruption_aggragate	which = privilege_corruption_GN }
		change_variable = {		which = privilege_corruption_aggragate	which = privilege_corruption_LN }
		change_variable = {		which = privilege_corruption_aggragate	which = privilege_corruption_BG }
		change_variable = {		which = privilege_corruption_aggragate	which = privilege_corruption_BU }
	}
	
	assign_corruption_modifier = {
		estate_prefix = GN
	}
	assign_corruption_modifier = {
		estate_prefix = LN
	}
	assign_corruption_modifier = {
		estate_prefix = BG
	}
	#assign_corruption_modifier = {
	#	estate_prefix = BU
	#}
	
	# TODO: Clear variables (privilege_corruption_XX)
	
}

POP_set_privilege_demand_ticker = {
	# Greater nobles
	if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share	value = 0.01 }
		}
		random_list = { ### Sets random starting privilege demand
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 1 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 4 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 8 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 12 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 16 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 20 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 24 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 28 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 32 } }
			10 = { set_variable = { which = privilege_demand_ticker_greater_nobles	value = 36 } }
		}
	}
	# Lesser nobles
	if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share	value = 0.01 }
		}
		random_list = { ### Sets random starting privilege demand
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 1 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 4 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 8 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 12 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 16 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 20 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 24 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 28 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 32 } }
			10 = { set_variable = { which = privilege_demand_ticker_lesser_nobles	value = 36 } }
		}
	}
	# Burghers
	if = {
		limit = {
			check_variable = { which = estate_burghers_weight_share		value = 0.01 }
		}
		random_list = { ### Sets random starting privilege demand
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 1 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 4 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 8 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 12 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 16 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 20 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 24 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 28 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 32 } }
			10 = { set_variable = { which = privilege_demand_ticker_burghers	value = 36 } }
		}
	}
	# State
	if = {
		limit = {
			always = no # No state corruption yet
			check_variable = { which = estate_bureaucracy_weight_share		value = 0.01 }
		}
		random_list = { ### Sets random starting privilege demand
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 1 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 3 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 6 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 9 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 12 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 15 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 18 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 21 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 24 } }
			10 = { set_variable = { which = privilege_demand_ticker_state	value = 27 } }
		}
	}
}

tribe_partial_loot_war_modifier = {
	if = {
		limit = {
			check_variable = { which = partial_tribe_loot				value = 25 }
		}
		add_country_modifier = { name = TR_tribe_loot_30	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = partial_tribe_loot				value = 20 }
		}
		add_country_modifier = { name = TR_tribe_loot_25	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = partial_tribe_loot				value = 15 }
		}
		add_country_modifier = { name = TR_tribe_loot_20	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = partial_tribe_loot				value = 10 }
		}
		add_country_modifier = { name = TR_tribe_loot_15	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = partial_tribe_loot				value = 5 }
		}
		add_country_modifier = { name = TR_tribe_loot_10	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = partial_tribe_loot				value = 2.5 }
		}
		add_country_modifier = { name = TR_tribe_loot_5 	duration = -1 }
	}
}

tribe_full_loot_war_modifier = {
	if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 45 }
		}
		add_country_modifier = { name = TR_tribe_loot_50	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 40 }
		}
		add_country_modifier = { name = TR_tribe_loot_45	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 35 }
		}
		add_country_modifier = { name = TR_tribe_loot_40	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 30 }
		}
		add_country_modifier = { name = TR_tribe_loot_35	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 25 }
		}
		add_country_modifier = { name = TR_tribe_loot_30	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 20 }
		}
		add_country_modifier = { name = TR_tribe_loot_25	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 15 }
		}
		add_country_modifier = { name = TR_tribe_loot_20	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 10 }
		}
		add_country_modifier = { name = TR_tribe_loot_15	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 5 }
		}
		add_country_modifier = { name = TR_tribe_loot_10	duration = -1 }
	}
	else_if = {
		limit = {
			check_variable = { which = full_tribe_loot				value = 2.5 }
		}
		add_country_modifier = { name = TR_tribe_loot_5 	duration = -1 }
	}
}

GN_clear_privilege_demand_flags = {
	clr_country_flag = choose_GN_authority_to_govern_locally_1
	clr_country_flag = choose_GN_authority_to_govern_locally_2
	clr_country_flag = choose_ceremonial_generalships_1
	clr_country_flag = choose_ceremonial_generalships_2
	clr_country_flag = choose_GN_relaxed_levy_obligations_1
	clr_country_flag = choose_GN_relaxed_levy_obligations_2
	clr_country_flag = choose_GN_tax_exemptions_1
	clr_country_flag = choose_GN_tax_exemptions_2
	clr_country_flag = choose_GN_tax_exemptions_3
	clr_country_flag = choose_GN_tax_exemptions_4
	clr_country_flag = choose_GN_exclude_commoners_cabinet_1
	clr_country_flag = choose_GN_exclude_commoners_cabinet_2
	clr_country_flag = choose_GN_high_court_titles_1
	clr_country_flag = choose_GN_high_court_titles_2
	clr_country_flag = choose_GN_high_nobles_court_1
	clr_country_flag = choose_GN_high_nobles_court_2
	clr_country_flag = choose_commoners_banned_from_officers_corps_1
	clr_country_flag = choose_commoners_banned_from_officers_corps_2
}

LN_clear_privilege_demand_flags = {
	clr_country_flag = choose_LN_authority_to_govern_locally_1
	clr_country_flag = choose_LN_authority_to_govern_locally_2
	clr_country_flag = choose_LN_relaxed_levy_obligations_1
	clr_country_flag = choose_LN_relaxed_levy_obligations_2
	clr_country_flag = choose_LN_tax_exemptions_1
	clr_country_flag = choose_LN_tax_exemptions_2
	clr_country_flag = choose_LN_tax_exemptions_3
	clr_country_flag = choose_LN_tax_exemptions_4
	clr_country_flag = choose_LN_high_court_titles_1
	clr_country_flag = choose_LN_high_court_titles_2
	clr_country_flag = choose_LN_promotion
}

BG_clear_privilege_demand_flags = {
	clr_country_flag = choose_BG_authority_to_govern_locally_1
	clr_country_flag = choose_BG_authority_to_govern_locally_2
	clr_country_flag = choose_BG_right_of_commerce_1
	clr_country_flag = choose_BG_right_of_commerce_2
	clr_country_flag = choose_BG_resist_embargoes_1
	clr_country_flag = choose_BG_resist_embargoes_2
	clr_country_flag = choose_BG_exemption_from_military_services_1
	clr_country_flag = choose_BG_exemption_from_military_services_2
	clr_country_flag = choose_BG_expanded_ship_builders_privileges_1
	clr_country_flag = choose_BG_expanded_ship_builders_privileges_2
	clr_country_flag = choose_BG_appoint_as_court_suppliers_1
	clr_country_flag = choose_BG_appoint_as_court_suppliers_2
	clr_country_flag = choose_BG_tolerate_smuggling_1
	clr_country_flag = choose_BG_tolerate_smuggling_2
	clr_country_flag = choose_BG_honorary_noble_titles_1
	clr_country_flag = choose_BG_honorary_noble_titles_2
}

clear_priv_demand_variables = {
	set_variable = { which = privilege_demand_modifier					value = 0 }
	set_variable = { which = privilege_admin_modifier					value = 0 }
	set_variable = { which = privilege_admin_modifier_den				value = 0 }
	set_variable = { which = privilege_GN_counter_inertia				value = 0 }
	set_variable = { which = privilege_GN_counter_inertia_adjust		value = 0 }
	set_variable = { which = privilege_GN_loyalty_malus					value = 0 }
	set_variable = { which = privilege_demand_greater_nobles_yearl		value = 0 }
	set_variable = { which = GN_privilege_pain_modifier					value = 0 }
	set_variable = { which = privilege_LN_counter_inertia				value = 0 }
	set_variable = { which = privilege_LN_counter_inertia_adjust		value = 0 }
	set_variable = { which = privilege_LN_loyalty_malus					value = 0 }
	set_variable = { which = privilege_demand_lesser_nobles_yearly		value = 0 }
	set_variable = { which = LN_privilege_pain_modifier					value = 0 }
	set_variable = { which = privilege_BG_counter_inertia				value = 0 }
	set_variable = { which = privilege_BG_counter_inertia_adjust		value = 0 }
	set_variable = { which = privilege_BG_loyalty_malus					value = 0 }
	set_variable = { which = privilege_demand_burghers_yearly			value = 0 }
	set_variable = { which = BG_privilege_pain_modifier					value = 0 }
	set_variable = { which = privilege_BU_counter_inertia				value = 0 }
	set_variable = { which = privilege_BU_counter_inertia_adjust		value = 0 }
	set_variable = { which = privilege_demand_bureaucracy_yearly		value = 0 }
	set_variable = { which = GN_corruption_current						value = 0 }
	set_variable = { which = GN_corruption_cost_1						value = 0 }
	set_variable = { which = greater_nobles_loyalty_removed_a			value = 0 }
	set_variable = { which = hit_to_legitimacy							value = 0 }
	set_variable = { which = hit_to_prestige							value = 0 }
	set_variable = { which = GN_hit_to_military							value = 0 }
	set_variable = { which = stability_hit								value = 0 }
	set_variable = { which = milit_cost_a								value = 0 }
	set_variable = { which = ai_corruption_choice						value = 0 }
	set_variable = { which = LN_corruption_current						value = 0 }
	set_variable = { which = LN_corruption_cost_1						value = 0 }
	set_variable = { which = lesser_nobles_loyalty_removed_a			value = 0 }
	set_variable = { which = hit_to_legitimacy							value = 0 }
	set_variable = { which = hit_to_prestige							value = 0 }
	set_variable = { which = LN_hit_to_military							value = 0 }
	set_variable = { which = stability_hit								value = 0 }
	set_variable = { which = admin_cost_a								value = 0 }
	set_variable = { which = ai_corruption_choice						value = 0 }
	set_variable = { which = estate_lesser_nobles_promotion_check		value = 0 }
	set_variable = { which = BG_corruption_current						value = 0 }
	set_variable = { which = BG_corruption_cost_1						value = 0 }
	set_variable = { which = burghers_loyalty_removed_a					value = 0 }
	set_variable = { which = hit_to_legitimacy							value = 0 }
	set_variable = { which = hit_to_prestige							value = 0 }
	set_variable = { which = BG_commercial_havoc						value = 0 }
	set_variable = { which = stability_hit								value = 0 }
	set_variable = { which = diplo_cost_a								value = 0 }
	set_variable = { which = autonomy_added								value = 0 }
}
clear_estate_loyalty_swings = {
	set_variable = { which = court_level_modifier				value = 0 }
	set_variable = { which = greater_nobles_loyalty_added_a		value = 0 }
	set_variable = { which = lesser_nobles_loyalty_added_a		value = 0 }
	set_variable = { which = burghers_loyalty_added_a			value = 0 }
	set_variable = { which = privilege_stability_gain			value = 0 }
}

POP_tribes_add_institution = {
	add_institution_embracement = {
		which = $institution$
		value = -100
	}
	set_variable = { which = tribals_ratio_scaled 						value = 100 }
	subtract_variable = { which = tribals_ratio_scaled					which = tribals_ratio }
	divide_variable = { which = tribals_ratio_scaled 					value = 100 }
	multiply_variable = { which = tribals_ratio_scaled					value = 1.14 } #Map 0-~88 to 0-100
	if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.50 } }
		if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.75 } }
			if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.88 } }
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.94 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.97 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.99 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 1.00 } }
								add_institution_embracement = {
									which = $institution$
									value = 100
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 99
								}
							}
						}
						else = {
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.98 } }
								add_institution_embracement = {
									which = $institution$
									value = 98
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 97
								}
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.95 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.96 } }
								add_institution_embracement = {
									which = $institution$
									value = 96
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 95
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 94
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.91 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.92 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.93 } }
								add_institution_embracement = {
									which = $institution$
									value = 93
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 92
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 91
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.89 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.90 } }
								add_institution_embracement = {
									which = $institution$
									value = 90
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 89
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 88
							}
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.81 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.84 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.86 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.87 } }
								add_institution_embracement = {
									which = $institution$
									value = 87
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 86
								}
							}
						}
						else = {
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.85 } }
								add_institution_embracement = {
									which = $institution$
									value = 85
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 84
								}
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.82 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.83 } }
								add_institution_embracement = {
									which = $institution$
									value = 83
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 82
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 81
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.78 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.79 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.80 } }
								add_institution_embracement = {
									which = $institution$
									value = 80
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 79
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 78
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.76 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.77 } }
								add_institution_embracement = {
									which = $institution$
									value = 77
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 76
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 75
							}
						}
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.62 } }
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.68 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.71 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.73 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.74 } }
								add_institution_embracement = {
									which = $institution$
									value = 74
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 73
								}
							}
						}
						else = {
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.72 } }
								add_institution_embracement = {
									which = $institution$
									value = 72
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 71
								}
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.69 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.70 } }
								add_institution_embracement = {
									which = $institution$
									value = 70
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 69
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 68
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.65 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.66 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.67 } }
								add_institution_embracement = {
									which = $institution$
									value = 67
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 66
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 65
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.63 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.64 } }
								add_institution_embracement = {
									which = $institution$
									value = 64
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 63
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 62
							}
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.56 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.59 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.60 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.61 } }
								add_institution_embracement = {
									which = $institution$
									value = 61
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 60
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 59
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.57 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.58 } }
								add_institution_embracement = {
									which = $institution$
									value = 58
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 57
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 56
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.53 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.54 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.55 } }
								add_institution_embracement = {
									which = $institution$
									value = 55
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 54
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 53
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.51 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.52 } }
								add_institution_embracement = {
									which = $institution$
									value = 52
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 51
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 50
							}
						}
					}
				}
			}
		}
	}
	else = {
		if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.25 } }
			if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.37 } }
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.43 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.46 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.48 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.49 } }
								add_institution_embracement = {
									which = $institution$
									value = 49
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 48
								}
							}
						}
						else = {
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.47 } }
								add_institution_embracement = {
									which = $institution$
									value = 47
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 46
								}
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.44 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.45 } }
								add_institution_embracement = {
									which = $institution$
									value = 45
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 44
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 43
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.40 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.41 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.42 } }
								add_institution_embracement = {
									which = $institution$
									value = 42
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 41
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 40
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.38 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.39 } }
								add_institution_embracement = {
									which = $institution$
									value = 39
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 38
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 37
							}
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.31 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.34 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.35 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.36 } }
								add_institution_embracement = {
									which = $institution$
									value = 36
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 35
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 34
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.32 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.33 } }
								add_institution_embracement = {
									which = $institution$
									value = 33
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 32
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 31
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.28 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.29 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.30 } }
								add_institution_embracement = {
									which = $institution$
									value = 30
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 29
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 28
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.26 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.27 } }
								add_institution_embracement = {
									which = $institution$
									value = 27
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 26
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 25
							}
						}
					}
				}
			}
		}
		else = {
			if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.12 } }
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.18 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.21 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.23 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.24 } }
								add_institution_embracement = {
									which = $institution$
									value = 24
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 23
								}
							}
						}
						else = {
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.22 } }
								add_institution_embracement = {
									which = $institution$
									value = 22
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 21
								}
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.19 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.20 } }
								add_institution_embracement = {
									which = $institution$
									value = 20
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 19
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 18
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.15 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.16 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.17 } }
								add_institution_embracement = {
									which = $institution$
									value = 17
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 16
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 15
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.13 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.14 } }
								add_institution_embracement = {
									which = $institution$
									value = 14
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 13
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 12
							}
						}
					}
				}
			}
			else = {
				if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.6 } }
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.9 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.10 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.11 } }
								add_institution_embracement = {
									which = $institution$
									value = 11
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 10
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 9
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.7 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.8 } }
								add_institution_embracement = {
									which = $institution$
									value = 8
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 7
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 6
							}
						}
					}
				}
				else = {
					if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.3 } }
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.4 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.5 } }
								add_institution_embracement = {
									which = $institution$
									value = 5
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 4
								}
							}
						}
						else = {
							add_institution_embracement = {
								which = $institution$
								value = 3
							}
						}
					}
					else = {
						if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.1 } }
							if = { limit = { check_variable = { which = tribals_ratio_scaled value = 0.2 } }
								add_institution_embracement = {
									which = $institution$
									value = 2
								}
							}
							else = {
								add_institution_embracement = {
									which = $institution$
									value = 1
								}
							}
						}
					}
				}
			}
		}
	}
	set_variable = { which = tribals_ratio_scaled 		value = 0 }
}

POP_update_estates_influence = { ### This code chain here sets estate interface influence.  For cosmetics only
	if = {
		limit = {
			check_variable = { which = estate_greater_nobles_weight_share value = 0.01 }
		}
		set_variable = { 	  which = estate_greater_nobles_influence_ticker 		value = 0 }
		set_variable = { 	  which = estate_greater_nobles_influence_ticker 		which = estate_greater_nobles_weight_share }
		multiply_variable = { which = estate_greater_nobles_influence_ticker		value = 100 }
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 50 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 50 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_50 }
				}
				set_country_flag = greater_nobles_influence_50
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_50
			}
			clr_country_flag = greater_nobles_influence_50
		}
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 25 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 25 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_25 }
				}
				set_country_flag = greater_nobles_influence_25
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_25
			}
			clr_country_flag = greater_nobles_influence_25
		}
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 13 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 13 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_13 }
				}
				set_country_flag = greater_nobles_influence_13
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_13
			}
			clr_country_flag = greater_nobles_influence_13
		}
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 6 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 6 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_6 }
				}
				set_country_flag = greater_nobles_influence_6
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_6
			}
			clr_country_flag = greater_nobles_influence_6
		}
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 3 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 3 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_3 }
				}
				set_country_flag = greater_nobles_influence_3
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_3
			}
			clr_country_flag = greater_nobles_influence_3
		}
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 2 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 2 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_2 }
				}
				set_country_flag = greater_nobles_influence_2
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_2
			}
			clr_country_flag = greater_nobles_influence_2
		}
		if = {
			limit = {
				check_variable = { which = estate_greater_nobles_influence_ticker	value = 1 }
			}
			subtract_variable = { which = estate_greater_nobles_influence_ticker 	value = 1 }
			if = {
				limit = {
					NOT = { has_country_flag = greater_nobles_influence_1 }
				}
				set_country_flag = greater_nobles_influence_1
			}
		}
		else_if = {
			limit = {
				has_country_flag = greater_nobles_influence_1
			}
			clr_country_flag = greater_nobles_influence_1
		}
	}
	else = {
		if = { limit = { has_country_flag = greater_nobles_influence_50 }
			clr_country_flag = greater_nobles_influence_50
		}
		if = { limit = { has_country_flag = greater_nobles_influence_25 }
			clr_country_flag = greater_nobles_influence_25
		}
		if = { limit = { has_country_flag = greater_nobles_influence_13 }
			clr_country_flag = greater_nobles_influence_13
		}
		if = { limit = { has_country_flag = greater_nobles_influence_6 }
			clr_country_flag = greater_nobles_influence_6
		}
		if = { limit = { has_country_flag = greater_nobles_influence_3 }
			clr_country_flag = greater_nobles_influence_3
		}
		if = { limit = { has_country_flag = greater_nobles_influence_2 }
			clr_country_flag = greater_nobles_influence_2
		}
		if = { limit = { has_country_flag = greater_nobles_influence_1 }
			clr_country_flag = greater_nobles_influence_1
		}
	}
	
	if = {
		limit = {
			check_variable = { which = estate_lesser_nobles_weight_share value = 0.01 }
		}
		set_variable = { 	  which = estate_lesser_nobles_influence_ticker 		value = 0 }
		set_variable = { 	  which = estate_lesser_nobles_influence_ticker 		which = estate_lesser_nobles_weight_share }
		multiply_variable = { which = estate_lesser_nobles_influence_ticker			value = 100 }
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 50 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 50 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_50 }
				}
				set_country_flag = lesser_nobles_influence_50
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_50
			}
			clr_country_flag = lesser_nobles_influence_50
		}
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 25 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 25 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_25 }
				}
				set_country_flag = lesser_nobles_influence_25
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_25
			}
			clr_country_flag = lesser_nobles_influence_25
		}
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 13 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 13 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_13 }
				}
				set_country_flag = lesser_nobles_influence_13
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_13
			}
			clr_country_flag = lesser_nobles_influence_13
		}
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 6 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 6 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_6 }
				}
				set_country_flag = lesser_nobles_influence_6
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_6
			}
			clr_country_flag = lesser_nobles_influence_6
		}
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 3 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 3 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_3 }
				}
				set_country_flag = lesser_nobles_influence_3
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_3
			}
			clr_country_flag = lesser_nobles_influence_3
		}
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 2 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 2 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_2 }
				}
				set_country_flag = lesser_nobles_influence_2
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_2
			}
			clr_country_flag = lesser_nobles_influence_2
		}
		if = {
			limit = {
				check_variable = { which = estate_lesser_nobles_influence_ticker	value = 1 }
			}
			subtract_variable = { which = estate_lesser_nobles_influence_ticker 	value = 1 }
			if = {
				limit = {
					NOT = { has_country_flag = lesser_nobles_influence_1 }
				}
				set_country_flag = lesser_nobles_influence_1
			}
		}
		else_if = {
			limit = {
				has_country_flag = lesser_nobles_influence_1
			}
			clr_country_flag = lesser_nobles_influence_1
		}
	}
	else = {
		if = { limit = { has_country_flag = lesser_nobles_influence_50 }
			clr_country_flag = lesser_nobles_influence_50
		}
		if = { limit = { has_country_flag = lesser_nobles_influence_25 }
			clr_country_flag = lesser_nobles_influence_25
		}
		if = { limit = { has_country_flag = lesser_nobles_influence_13 }
			clr_country_flag = lesser_nobles_influence_13
		}
		if = { limit = { has_country_flag = lesser_nobles_influence_6 }
			clr_country_flag = lesser_nobles_influence_6
		}
		if = { limit = { has_country_flag = lesser_nobles_influence_3 }
			clr_country_flag = lesser_nobles_influence_3
		}
		if = { limit = { has_country_flag = lesser_nobles_influence_2 }
			clr_country_flag = lesser_nobles_influence_2
		}
		if = { limit = { has_country_flag = lesser_nobles_influence_1 }
			clr_country_flag = lesser_nobles_influence_1
		}
	}
	
	if = {
		limit = {
			check_variable = { which = estate_burghers_weight_share value = 0.01 }
		}
		set_variable = {	  which = estate_burghers_influence_ticker 		value = 0 }
		set_variable = { 	  which = estate_burghers_influence_ticker 		which = estate_burghers_weight_share }
		multiply_variable = { which = estate_burghers_influence_ticker		value = 100 }
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 50 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 50 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_50 }
				}
				set_country_flag = burghers_influence_50
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_50
			}
			clr_country_flag = burghers_influence_50
		}
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 25 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 25 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_25 }
				}
				set_country_flag = burghers_influence_25
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_25
			}
			clr_country_flag = burghers_influence_25
		}
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 13 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 13 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_13 }
				}
				set_country_flag = burghers_influence_13
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_13
			}
			clr_country_flag = burghers_influence_13
		}
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 6 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 6 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_6 }
				}
				set_country_flag = burghers_influence_6
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_6
			}
			clr_country_flag = burghers_influence_6
		}
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 3 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 3 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_3 }
				}
				set_country_flag = burghers_influence_3
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_3
			}
			clr_country_flag = burghers_influence_3
		}
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 2 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 2 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_2 }
				}
				set_country_flag = burghers_influence_2
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_2
			}
			clr_country_flag = burghers_influence_2
		}
		if = {
			limit = {
				check_variable = { which = estate_burghers_influence_ticker	value = 1 }
			}
			subtract_variable = { which = estate_burghers_influence_ticker 	value = 1 }
			if = {
				limit = {
					NOT = { has_country_flag = burghers_influence_1 }
				}
				set_country_flag = burghers_influence_1
			}
		}
		else_if = {
			limit = {
				has_country_flag = burghers_influence_1
			}
			clr_country_flag = burghers_influence_1
		}
	}
	else = {
		if = { limit = { has_country_flag = burghers_influence_50 }
			clr_country_flag = burghers_influence_50
		}
		if = { limit = { has_country_flag = burghers_influence_25 }
			clr_country_flag = burghers_influence_25
		}
		if = { limit = { has_country_flag = burghers_influence_13 }
			clr_country_flag = burghers_influence_13
		}
		if = { limit = { has_country_flag = burghers_influence_6 }
			clr_country_flag = burghers_influence_6
		}
		if = { limit = { has_country_flag = burghers_influence_3 }
			clr_country_flag = burghers_influence_3
		}
		if = { limit = { has_country_flag = burghers_influence_2 }
			clr_country_flag = burghers_influence_2
		}
		if = { limit = { has_country_flag = burghers_influence_1 }
			clr_country_flag = burghers_influence_1
		}
	}
	
	if = {
		limit = {
			check_variable = { which = estate_tribals_weight_share value = 0.01 }
		}
		set_variable = { 	  which = estate_tribals_influence_ticker		value = 0 }
		set_variable = { 	  which = estate_tribals_influence_ticker		which = estate_tribals_weight_share }
		multiply_variable = { which = estate_tribals_influence_ticker		value = 100 }
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 50 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker 	value = 50 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_50 }
				}
				set_country_flag = tribals_influence_50
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_50
			}
			clr_country_flag = tribals_influence_50
		}
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 25 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker	value = 25 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_25 }
				}
				set_country_flag = tribals_influence_25
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_25
			}
			clr_country_flag = tribals_influence_25
		}
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 13 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker	value = 13 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_13 }
				}
				set_country_flag = tribals_influence_13
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_13
			}
			clr_country_flag = tribals_influence_13
		}
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 6 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker	value = 6 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_6 }
				}
				set_country_flag = tribals_influence_6
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_6
			}
			clr_country_flag = tribals_influence_6
		}
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 3 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker	value = 3 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_3 }
				}
				set_country_flag = tribals_influence_3
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_3
			}
			clr_country_flag = tribals_influence_3
		}
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 2 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker	value = 2 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_2 }
				}
				set_country_flag = tribals_influence_2
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_2
			}
			clr_country_flag = tribals_influence_2
		}
		if = {
			limit = {
				check_variable = { which = estate_tribals_influence_ticker	value = 1 }
			}
			subtract_variable = { which = estate_tribals_influence_ticker	value = 1 }
			if = {
				limit = {
					NOT = { has_country_flag = tribals_influence_1 }
				}
				set_country_flag = tribals_influence_1
			}
		}
		else_if = {
			limit = {
				has_country_flag = tribals_influence_1
			}
			clr_country_flag = tribals_influence_1
		}
	}
	else = {
		if = { limit = { has_country_flag = tribals_influence_50 }
			clr_country_flag = tribals_influence_50
		}
		if = { limit = { has_country_flag = tribals_influence_25 }
			clr_country_flag = tribals_influence_25
		}
		if = { limit = { has_country_flag = tribals_influence_13 }
			clr_country_flag = tribals_influence_13
		}
		if = { limit = { has_country_flag = tribals_influence_6 }
			clr_country_flag = tribals_influence_6
		}
		if = { limit = { has_country_flag = tribals_influence_3 }
			clr_country_flag = tribals_influence_3
		}
		if = { limit = { has_country_flag = tribals_influence_2 }
			clr_country_flag = tribals_influence_2
		}
		if = { limit = { has_country_flag = tribals_influence_1 }
			clr_country_flag = tribals_influence_1
		}
	}
	
	if = {
		limit = {
			check_variable = { which = estate_freeholders_weight_share value = 0.01 }
		}
		set_variable = { 	  which = estate_freeholders_influence_ticker		value = 0 }
		set_variable = { 	  which = estate_freeholders_influence_ticker		which = estate_freeholders_weight_share }
		multiply_variable = { which = estate_freeholders_influence_ticker		value = 100 }
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 50 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 50 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_50 }
				}
				set_country_flag = freeholders_influence_50
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_50
			}
			clr_country_flag = freeholders_influence_50
		}
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 25 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 25 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_25 }
				}
				set_country_flag = freeholders_influence_25
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_25
			}
			clr_country_flag = freeholders_influence_25
		}
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 13 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 13 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_13 }
				}
				set_country_flag = freeholders_influence_13
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_13
			}
			clr_country_flag = freeholders_influence_13
		}
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 6 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 6 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_6 }
				}
				set_country_flag = freeholders_influence_6
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_6
			}
			clr_country_flag = freeholders_influence_6
		}
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 3 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 3 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_3 }
				}
				set_country_flag = freeholders_influence_3
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_3
			}
			clr_country_flag = freeholders_influence_3
		}
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 2 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 2 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_2 }
				}
				set_country_flag = freeholders_influence_2
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_2
			}
			clr_country_flag = freeholders_influence_2
		}
		if = {
			limit = {
				check_variable = { which = estate_freeholders_influence_ticker	value = 1 }
			}
			subtract_variable = { which = estate_freeholders_influence_ticker	value = 1 }
			if = {
				limit = {
					NOT = { has_country_flag = freeholders_influence_1 }
				}
				set_country_flag = freeholders_influence_1
			}
		}
		else_if = {
			limit = {
				has_country_flag = freeholders_influence_1
			}
			clr_country_flag = freeholders_influence_1
		}
	}
	else = {
		if = { limit = { has_country_flag = freeholders_influence_50 }
			clr_country_flag = freeholders_influence_50
		}
		if = { limit = { has_country_flag = freeholders_influence_25 }
			clr_country_flag = freeholders_influence_25
		}
		if = { limit = { has_country_flag = freeholders_influence_13 }
			clr_country_flag = freeholders_influence_13
		}
		if = { limit = { has_country_flag = freeholders_influence_6 }
			clr_country_flag = freeholders_influence_6
		}
		if = { limit = { has_country_flag = freeholders_influence_3 }
			clr_country_flag = freeholders_influence_3
		}
		if = { limit = { has_country_flag = freeholders_influence_2 }
			clr_country_flag = freeholders_influence_2
		}
		if = { limit = { has_country_flag = freeholders_influence_1 }
			clr_country_flag = freeholders_influence_1
		}
	}
	
	if = {
		limit = {
			check_variable = { which = estate_bureaucracy_weight_share value = 0.01 }
		}
		set_variable = { 	  which = estate_bureaucracy_influence_ticker		value = 0 }
		set_variable = { 	  which = estate_bureaucracy_influence_ticker		which = estate_bureaucracy_weight_share }
		multiply_variable = { which = estate_bureaucracy_influence_ticker		value = 100 }
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 50 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 50 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_50 }
				}
				set_country_flag = bureaucracy_influence_50
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_50
			}
			clr_country_flag = bureaucracy_influence_50
		}
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 25 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 25 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_25 }
				}
				set_country_flag = bureaucracy_influence_25
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_25
			}
			clr_country_flag = bureaucracy_influence_25
		}
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 13 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 13 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_13 }
				}
				set_country_flag = bureaucracy_influence_13
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_13
			}
			clr_country_flag = bureaucracy_influence_13
		}
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 6 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 6 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_6 }
				}
				set_country_flag = bureaucracy_influence_6
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_6
			}
			clr_country_flag = bureaucracy_influence_6
		}
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 3 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 3 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_3 }
				}
				set_country_flag = bureaucracy_influence_3
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_3
			}
			clr_country_flag = bureaucracy_influence_3
		}
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 2 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 2 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_2 }
				}
				set_country_flag = bureaucracy_influence_2
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_2
			}
			clr_country_flag = bureaucracy_influence_2
		}
		if = {
			limit = {
				check_variable = { which = estate_bureaucracy_influence_ticker	value = 1 }
			}
			subtract_variable = { which = estate_bureaucracy_influence_ticker	value = 1 }
			if = {
				limit = {
					NOT = { has_country_flag = bureaucracy_influence_1 }
				}
				set_country_flag = bureaucracy_influence_1
			}
		}
		else_if = {
			limit = {
				has_country_flag = bureaucracy_influence_1
			}
			clr_country_flag = bureaucracy_influence_1
		}
	}
	else = {
		if = { limit = { has_country_flag = bureaucracy_influence_50 }
			clr_country_flag = bureaucracy_influence_50
		}
		if = { limit = { has_country_flag = bureaucracy_influence_25 }
			clr_country_flag = bureaucracy_influence_25
		}
		if = { limit = { has_country_flag = bureaucracy_influence_13 }
			clr_country_flag = bureaucracy_influence_13
		}
		if = { limit = { has_country_flag = bureaucracy_influence_6 }
			clr_country_flag = bureaucracy_influence_6
		}
		if = { limit = { has_country_flag = bureaucracy_influence_3 }
			clr_country_flag = bureaucracy_influence_3
		}
		if = { limit = { has_country_flag = bureaucracy_influence_2 }
			clr_country_flag = bureaucracy_influence_2
		}
		if = { limit = { has_country_flag = bureaucracy_influence_1 }
			clr_country_flag = bureaucracy_influence_1
		}
	}
}

calc_tribal_tribute_favor = {
	if = {
		limit = {
			has_country_flag = tribals_recieving_tribute
			check_variable = { which = estate_tribals_weight_share		value = 0.01 }
			check_variable = { which = estate_tribals_treasury_annual	value = 5 }
		}
		set_variable = { which = tribal_tribute_favor_calc			which = estate_tribals_treasury_annual }
		multiply_variable = { which = tribal_tribute_favor_calc		value = 0.05 } # 5% of their income as tribute.
		set_variable = { which = tribal_tribute_favor				which = tribal_tribute_favor_calc }
		
		set_variable = { which = tribal_tribute_favor_calc			value = 0 }
		set_variable = { which = tribes_loyalty_added				value = 0.334 }
		multiply_variable = { which = tribes_loyalty_added			which = ruler_diplo_ability }
		divide_variable = {   which = tribes_loyalty_added 			value = 100 }
		multiply_variable = { which = tribes_loyalty_added 			value = 100 }
		estate_tribes_loyalty_added = yes
		if = {
			limit = {
				NOT = { has_country_modifier = tribal_tribute_favor }
			}
			add_country_modifier = {
				name = tribal_tribute_favor
				duration = -1
				hidden = yes
			}
		}
	}
	else = {
		if = {
			limit = {
				has_country_modifier = tribal_tribute_favor
			}
			remove_country_modifier = tribal_tribute_favor
		}
		set_variable = { which = tribal_tribute_favor				value = 0 }
	}
}

TR_loyal_war_share = {
	set_variable = { which = TR_loyal_war_share_infantry						value = 0 }
	set_variable = { which = TR_loyal_war_share_infantry						which = TR_infantry_fielded }
	set_variable = { which = TR_loyal_war_share_cavalry							value = 0 }
	set_variable = { which = TR_loyal_war_share_cavalry							which = TR_cavalry_fielded }
	if = {
		limit = {
			check_variable = { which = TR_loyal_war_share_infantry 				value = 1 }
		}
		divide_variable = { which = TR_loyal_war_share_infantry 					which = $total_infantry_share$ }
	}
	if = {
		limit = {
			check_variable = { which = TR_loyal_war_share_cavalry 				value = 1 }
		}
		divide_variable = { which = TR_loyal_war_share_cavalry 					which = $total_cavalry_share$ }
	}
}


calc_settlement_score_gravity = {
	set_variable = { which = settlement_score_gravity					value = 0 }
	
	# Tribes in more diffuclt terrain take longer to settle, while tribes in fertile terrain settle sooner
	set_variable = { which = settlement_score_terrain_impact			value = 0 }
	# Nomadic land under the control of nomads takes longer to settle
	if = {
		limit = {
			nomad_speed_boost_trigger = yes
			
			has_province_flag = nomad_speed_boost
		}
		change_variable = { which = settlement_score_terrain_impact		value = -10 }
	}
	# Less hosptiable climates take longer to settle.
	if = {
		limit = {
			OR = {
				has_climate = arid
				has_climate = arctic
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = -10 }
	}
	else_if = {
		limit = {
			has_climate = tropical
		}
		change_variable = { which = settlement_score_terrain_impact		value = -5 }
	}
	else = {
		change_variable = { which = settlement_score_terrain_impact		value = 5 }
	}
	if = { # Oasis provinces have their own gravity, since they are hubs for merchants and people in general
		limit = {
			has_province_modifier = oasis_route
			has_terrain = desert
		}
		change_variable = { which = settlement_score_terrain_impact		value = 25 }
	}
	if = {
		limit = {
			OR = {
				has_terrain = tundra
				has_terrain = steppe
				has_terrain = desert_mountain
				has_terrain = desert
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = 1 }
	}
	if = {
		limit = {
			OR = {
				has_terrain = coastal_desert
				has_terrain = mountain
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = 15 }
	}
	if = {
		limit = {
			OR = {
				has_terrain = jungle
				has_terrain = hills
				has_terrain = forest
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = 20 }
	}
	if = {
		limit = {
			OR = {
				has_terrain = marsh
				has_terrain = taiga
				has_terrain = woods
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = 30 }
	}
	if = {
		limit = {
			OR = {
				has_terrain = coastline
				has_terrain = highlands
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = 40 }
	}
	if = {
		limit = {
			OR = {
				has_terrain = drylands
				has_terrain = plains
				has_terrain = grasslands
				has_terrain = savannah
			}
		}
		change_variable = { which = settlement_score_terrain_impact		value = 50 }
	}
	if = {
		limit = {
			has_terrain = floodplains
		}
		change_variable = { which = settlement_score_terrain_impact		value = 55 }
	}
	if = {
		limit = {
			has_terrain = farmlands
		}
		change_variable = { which = settlement_score_terrain_impact		value = 65 }
	}
	change_variable = { which = settlement_score_gravity				which = settlement_score_terrain_impact }
	
	# Provinces with very high density encourage tribes to settle
	set_variable = { which = settlement_score_density_impact			which = rural_density }
	subtract_variable = { which = settlement_score_density_impact 		value = 1 }
	multiply_variable = { which = settlement_score_density_impact		value = 2 }
	logistic_funct = {
		type1=which type2=value type3=value type4=value
		inp=settlement_score_density_impact midpnt=0.6 steepns=7.5 maxval=25
	}
	set_variable = { which = settlement_score_density_impact				which = logistic_val }
	set_variable = { which = logistic_val									value = 0 }
	change_variable = { which = settlement_score_gravity					which = settlement_score_density_impact }
	
	# Provinces attracting people to the city encourage tribal migration
	if = {
		limit = {
			check_variable = { which = urban_gravity_total					value = 0.1 }
			check_variable = { which = urban_population						value = 0.1 }
		}
		set_variable = { which = settlement_score_urban_gravity_impact		which = urban_gravity_total }
		divide_variable = { which = settlement_score_urban_gravity_impact 	which = urban_population }
		subtract_variable = { which = settlement_score_urban_gravity_impact value = 1 }
		multiply_variable = { which = settlement_score_urban_gravity_impact	value = 2 }
		if = {
			limit = {
				check_variable = { which = settlement_score_urban_gravity_impact	value = 25 }
			}
			set_variable = { which = settlement_score_urban_gravity_impact		value = 25 }
		}
		change_variable = { which = settlement_score_gravity				which = settlement_score_urban_gravity_impact }
	}
	
	# Provinces with alot of urban population proportionate to their tribal pop will encourage settlement
	set_variable = { which = settlement_score_local_urban_impact			value = 0 }
	set_variable = { which = local_tribal_pop 								value = 0 }
	set_variable = { which = local_settled_pop 								value = 0 }
	
	# Add tribal population
	set_variable = { which = local_tribal_pop								which = rural_population }
	multiply_variable = { which = local_tribal_pop							which = tribals_ratio }
	divide_variable = { which = local_tribal_pop 							value = 100 }
	
	set_variable = { which = local_settled_pop								which = rural_population }
	set_variable = { which = inverse_tribals_ratio 							value = 100 }
	subtract_variable = { which = inverse_tribals_ratio						which = tribals_ratio }
	multiply_variable = { which = local_settled_pop							which = inverse_tribals_ratio }
	if = {
		limit = {
			check_variable = { which = local_settled_pop					value = 0.001 }
		}
		divide_variable = { which = local_settled_pop 						value = 100 }
	}
	
	# Add urban population
	change_variable = { which = local_settled_pop							which = urban_population }
	
	set_variable = { which = settlement_score_local_urban_impact			which = local_settled_pop }
	
	if = {
		limit = {
			check_variable = { which = settlement_score_local_urban_impact		value = 0.001 }
		}
		divide_variable = { which = settlement_score_local_urban_impact			which = local_tribal_pop }
		multiply_variable = { which = settlement_score_local_urban_impact		value = 25 }
		if = {
			limit = {
				check_variable = { which = settlement_score_local_urban_impact	value = 25 }
			}
			set_variable = { which = settlement_score_local_urban_impact		value = 25 }
		}
		change_variable = { which = settlement_score_gravity					which = settlement_score_local_urban_impact }
	}
	set_variable = { which = local_tribal_pop 								value = 0 }
	set_variable = { which = local_settled_pop 								value = 0 }
	
	# Provinces neigbouring a high proportion of settled population generally are encouraged to settle
	set_variable = { which = settlement_score_nearby_settled_impact 		value = 0 }
	set_variable = { which = neighbor_provinces_for_tribe 					value = 0 }
	set_variable = { which = tribal_pop 									value = 0 }
	set_variable = { which = settled_pop 									value = 0 }
	set_variable = { which = total_tribal_pop_stuff							value = 0 }
	every_neighbor_province = {
		PREV = { change_variable = { which = neighbor_provinces_for_tribe 	value = 1 }	}
		set_variable = { which = tribal_pop 								value = 0 }
		set_variable = { which = settled_pop 								value = 0 }
		if = {
			limit = {
				check_variable = { which = tribals_ratio					value = 0.001 }
			}
			# Add tribal population
			set_variable = { which = tribal_pop								which = rural_population }
			multiply_variable = { which = tribal_pop						which = tribals_ratio }
			divide_variable = { which = tribal_pop 							value = 100 }
			PREV = { change_variable = { which = tribal_pop 				which = PREV } }
			
			set_variable = { which = settled_pop							which = rural_population }
			set_variable = { which = inverse_tribals_ratio 					value = 100 }
			subtract_variable = { which = inverse_tribals_ratio				which = tribals_ratio }
			multiply_variable = { which = settled_pop						which = inverse_tribals_ratio }
			if = {
				limit = {
					check_variable = { which = settled_pop					value = 0.001 }
				}
				divide_variable = { which = settled_pop 					value = 100 }
			}
			set_variable = { which = inverse_tribals_ratio 					value = 0 }
		}
		else = {
			change_variable = { which = settled_pop							which = rural_population }
		}
		# Add urban population
		change_variable = { which = settled_pop								which = urban_population }
		PREV = { change_variable = { which = settled_pop 					which = PREV } }
		set_variable = { which = tribal_pop 								value = 0 }
		set_variable = { which = settled_pop 								value = 0 }
	}
	if = { # If there were any neighbouring provinces, calc a total ratio and add it to settlement
		limit = {
			check_variable = { which = neighbor_provinces_for_tribe					value = 1 }
			check_variable = { which = settled_pop									value = 0.001 }
		}
		change_variable = { which = total_tribal_pop_stuff							which = tribal_pop }
		change_variable = { which = total_tribal_pop_stuff							which = settled_pop }
		set_variable = { which = settlement_score_nearby_settled_impact 			which = settled_pop }
		divide_variable = { which = settlement_score_nearby_settled_impact			which = total_tribal_pop_stuff }
		multiply_variable = { which = settlement_score_nearby_settled_impact		value = 25 }
		if = {
			limit = {
				check_variable = { which = settlement_score_nearby_settled_impact	value = 25 }
			}
			set_variable = { which = settlement_score_nearby_settled_impact			value = 25 }
		}
		change_variable = { which = settlement_score_gravity						which = settlement_score_nearby_settled_impact }
	}
	set_variable = { which = neighbor_provinces_for_tribe 						value = 0 }
	set_variable = { which = tribal_pop 										value = 0 }
	set_variable = { which = settled_pop 										value = 0 }
	set_variable = { which = total_tribal_pop_stuff								value = 0 }
	
	# Provinces producing more rural goods encourages more settlement
	set_variable = { which = settlement_score_production_impact					value = 0 }
	change_variable = { which = settlement_score_production_impact				which = rural_production_power }
	logistic_funct = {
		type1=which type2=value type3=value type4=value
		inp=settlement_score_production_impact midpnt=0.5 steepns=8 maxval=15
	}
	set_variable = { which = settlement_score_production_impact					which = logistic_val }
	set_variable = { which = logistic_val										value = 0 }
	change_variable = { which = settlement_score_gravity						which = settlement_score_production_impact }
	
	# States with more centralisation can enforce policies that encourage or force settlement
	set_variable = { which = settlement_score_absolutism_impact					value = 0 }
	change_variable = { which = settlement_score_absolutism_impact				which = absolutismvar }
	if = {
		limit = {
			check_variable = { which = settlement_score_absolutism_impact		value = 0.01 }
		}
		divide_variable = { which = settlement_score_absolutism_impact			value = 2 }
		subtract_variable = { which = settlement_score_absolutism_impact		value = 15 }
	}
	else = {
		set_variable = { which = settlement_score_absolutism_impact				value = -15 }
	}
	# Legalism acts as a pull towards a more settled population
	if = {
		limit = {
			legalism = 100
		}
		change_variable = { which = settlement_score_absolutism_impact			value = 5 }
	}
	if = {
		limit = {
			owner = { has_institution = legalism }
		}
		change_variable = { which = settlement_score_absolutism_impact			value = 10 }
	}
	export_to_variable = {
		which = la_tribes
		value = local_autonomy
	}
	multiply_variable = { which = la_tribes										value = 0.1 } #-10 gravity from 100% LA
	multiply_variable = { which = la_tribes										value = -1 }
	change_variable = { which = settlement_score_absolutism_impact				which = la_tribes }
	set_variable = { which = la_tribes											value = 0 }
	
	change_variable = { which = settlement_score_gravity						which = settlement_score_absolutism_impact }
	
	# Wealth and power from trade encourages more settlement
	set_variable = { which = settlement_score_trade_impact						value = 0 }
	export_to_variable = { which = settlement_score_trade_impact				value = province_trade_power }
	logistic_funct = {
		type1=which type2=value type3=value type4=value
		inp=settlement_score_trade_impact midpnt=25 steepns=0.1 maxval=35
	}
	set_variable = { which = settlement_score_trade_impact						which = logistic_val }
	set_variable = { which = logistic_val										value = 0 }
	change_variable = { which = settlement_score_gravity						which = settlement_score_trade_impact }
	
	# Wealth from mined goods encourages further settlement
	set_variable = { which = settlement_score_mine_impact					value = 0 }
	change_variable = { which = settlement_score_mine_impact				which = mine_power }
	if = {
		limit = {
			check_variable = { which = settlement_score_mine_impact			value = 25 }
		}
		set_variable = { which = settlement_score_mine_impact				value = 25 }
	}
	change_variable = { which = settlement_score_gravity					which = settlement_score_mine_impact }
	
	
	# Wealth from mined goods encourages further settlement
	set_variable = { which = settlement_score_urban_production_impact			value = 0 }
	change_variable = { which = settlement_score_urban_production_impact		which = urban_production_power }
	multiply_variable = { which = settlement_score_urban_production_impact		value = 5 }
	if = {
		limit = {
			check_variable = { which = settlement_score_urban_production_impact	value = 25 }
		}
		set_variable = { which = settlement_score_urban_production_impact		value = 25 }
	}
	change_variable = { which = settlement_score_gravity						which = settlement_score_urban_production_impact }
	
	# Impact of various modifiers on settlement score
	set_variable = { which = settlement_score_modifier_impact					value = 0 }
	if = {
		limit = {
			owner = { has_country_modifier = advanced_tribal_claims }
		}
		subtract_variable = { which = settlement_score_modifier_impact			value = 50 }
	}
	
	change_variable = { which = settlement_score_gravity						which = settlement_score_modifier_impact }
	
	#Smaller tribes are harder to settle, larger tribes take less to do the same
	set_variable = { which = settlement_score_minority_impact			value = 0 }
	set_variable = { which = settlement_score_minority_impact			which = tribals_ratio }
		
	multiply_variable = { which = settlement_score_minority_impact 			value = 2 }
	subtract_variable = { which = settlement_score_minority_impact			value = 100 }
	if = { # Exponential effect
		limit = {
			check_variable = { which = settlement_score_minority_impact			value = 0.001 }
		}
		divide_variable = { which = settlement_score_minority_impact 			value = 100 }
		multiply_variable = { which = settlement_score_minority_impact 			which = settlement_score_minority_impact }
		multiply_variable = { which = settlement_score_minority_impact 			value = 100 }
		
		multiply_variable = { which = settlement_score_minority_impact 			value = 0.25 } #Up to +25 gravity
		if = {
			limit = {
				NOT = { check_variable = { which = settlement_score_minority_impact	value = 1 } }
			}
			set_variable = { which = settlement_score_minority_impact		value = 1 }
		}
	}
	else_if = { # Exponential effect, calculated on its inverse
		limit = {
			NOT = { check_variable = { which = settlement_score_minority_impact	value = 0 } }
		}
		
		divide_variable = { which = settlement_score_minority_impact 			value = 100 }
		multiply_variable = { which = settlement_score_minority_impact 			which = settlement_score_minority_impact }
		multiply_variable = { which = settlement_score_minority_impact 			value = 100 }
		
		multiply_variable = { which = settlement_score_minority_impact 			value = -1 }
		if = {
			limit = {
				check_variable = { which = settlement_score_minority_impact	value = -0.999 }
			}
			set_variable = { which = settlement_score_minority_impact		value = -1 }
		}
		# Prevent minorities from sending the ratio down below 0
		set_variable = { which = settlement_score_minority_impact_estimate		which = settlement_score_gravity }
		change_variable = { which = settlement_score_minority_impact_estimate	which = settlement_score_minority_impact }
		if = {
			limit = {
				NOT = { check_variable = { which = settlement_score_minority_impact_estimate	value = 0 } }
			}
			# If the minority impact would send it below 0, cap the effect at whatever sends it to 0
			set_variable = { which = settlement_score_minority_impact_calc						which = settlement_score_minority_impact }
			subtract_variable = { which = settlement_score_minority_impact_calc					which = settlement_score_minority_impact_estimate }
			set_variable = { which = settlement_score_minority_impact							which = settlement_score_minority_impact_calc }
			set_variable = { which = settlement_score_minority_impact_calc						value = 0 }
		}
		set_variable = { which = settlement_score_minority_impact_estimate		value = 0 }
	}
	else = {
		set_variable = { which = settlement_score_minority_impact			value = 1 }
	}
	
	change_variable = { which = settlement_score_gravity					which = settlement_score_minority_impact }
	
	if = { # For safety reasons, check if there is at least 1 score.
		limit = {
			is_variable_equal = { which = settlement_score_gravity			value = 0 }
		}
		set_variable = { which = settlement_score_gravity					value = 1 }
	}
	
	# Historical progress towards settlement pulls the gravity towards its existing momentum
	if = { # Scale by innate settlement
		limit = {
			check_variable = { which = settlement_score_progress			value = 1 }
		}
		set_variable = { which = settlement_score_progress_scalar			which = settlement_score_progress }
		
		divide_variable = { which = settlement_score_progress_scalar		which = settlement_score_gravity }
		change_variable = { which = settlement_score_progress_scalar		value = 0.85 }
		divide_variable = { which = settlement_score_progress_scalar		value = 1.85 } #Less effect on score
		multiply_variable = { which = settlement_score_gravity				which = settlement_score_progress_scalar }
	}
	
	if = { # Cap settlement at 99 here to ensure exponential effect
		limit = {
			check_variable = { which = settlement_score_gravity				value = 99.501 }
		}
		set_variable = { which = settlement_score_gravity					value = 99.5 }
	}
	else_if = { # For safety reasons, check if there is at least 1 score.
		limit = {
			NOT = { check_variable = { which = settlement_score_gravity		value = 0.5 } }
		}
		set_variable = { which = settlement_score_gravity					value = 0.5 }
	}
	
	set_variable = { which = settlement_score_progress_scalar			value = 0 }
	set_variable = { which = settlement_score_absolutism_impact			value = 0 }
	set_variable = { which = settlement_score_trade_impact				value = 0 }
	set_variable = { which = settlement_score_production_impact			value = 0 }
	set_variable = { which = settlement_score_urban_production_impact	value = 0 }
	set_variable = { which = settlement_score_nearby_settled_impact		value = 0 }
	set_variable = { which = settlement_score_local_urban_impact		value = 0 }
	set_variable = { which = settlement_score_urban_gravity_impact		value = 0 }
	set_variable = { which = settlement_score_density_impact			value = 0 }
	set_variable = { which = settlement_score_terrain_impact			value = 0 }
	set_variable = { which = settlement_score_minority_impact			value = 0 }
	set_variable = { which = settlement_score_modifier_impact			value = 0 }
}

tribals_settlement_calc = {
	set_variable = { which = tribal_settlement_score 					value = 0 }
	change_variable = { which = tribal_settlement_score 				which = settlement_score_gravity }
		
	multiply_variable = { which = tribal_settlement_score 				value = 2 }
	subtract_variable = { which = tribal_settlement_score				value = 100 }
	if = { # Exponential effect
		limit = {
			check_variable = { which = tribal_settlement_score			value = 0.001 }
		}
		divide_variable = { which = tribal_settlement_score 			value = 100 }
		multiply_variable = { which = tribal_settlement_score 			which = tribal_settlement_score }
		multiply_variable = { which = tribal_settlement_score 			value = 100 }
		if = {
			limit = {
				NOT = { check_variable = { which = tribal_settlement_score	value = 1 } }
			}
			set_variable = { which = tribal_settlement_score			value = 1 }
		}
	}
	else_if = { # Exponential effect, calculated on its inverse
		limit = {
			NOT = { check_variable = { which = tribal_settlement_score	value = 0 } }
		}
		divide_variable = { which = tribal_settlement_score 			value = 100 }
		multiply_variable = { which = tribal_settlement_score 			which = tribal_settlement_score }
		multiply_variable = { which = tribal_settlement_score 			value = 100 }
		
		multiply_variable = { which = settlement_score_minority_impact 	value = -1 }
		if = {
			limit = {
				check_variable = { which = tribal_settlement_score	value = -0.999 }
			}
			set_variable = { which = tribal_settlement_score		value = -1 }
		}
	}
	else = {
		set_variable = { which = tribal_settlement_score				value = 1 }
	}
	
	if = { # Cap settlement at 99 here to ensure exponential effect
		limit = {
			check_variable = { which = tribal_settlement_score			value = 100.001 }
		}
		set_variable = { which = tribal_settlement_score				value = 100 }
	}
	else_if = { # For safety reasons, check if there is at least 1 score.
		limit = {
			NOT = { check_variable = { which = tribal_settlement_score	value = -100 } }
		}
		set_variable = { which = tribal_settlement_score				value = -100 }
	}
}

tribals_ratio_update = {
	set_variable = { which = tribal_ratio_change						which = tribal_settlement_score }
	multiply_variable = { which = tribal_ratio_change					value = -1 }
	divide_variable = { which = tribal_ratio_change						value = 100 } # Max 1% a year
	
	change_variable = { which = tribals_ratio							which = tribal_ratio_change }
	
	if = { limit = { check_variable = { which = tribals_ratio				value = 100 } } #cap at boundaries
		set_variable = { which = tribals_ratio								value = 100 }
	}
	if = { limit = { NOT = { check_variable = { which = tribals_ratio		value = 0 } } } #cap at boundaries
		set_variable = { which = tribals_ratio								value = 0 }
	}
	
	set_variable = { which = tribal_ratio_change						value = 0 }
	
	set_variable = {   which = tribals_ratio_display		which = tribals_ratio }
	divide_variable = {   which = tribals_ratio_display		value = 100 }
	multiply_variable = {   which = tribals_ratio_display	value = 100 }
}